/*******************************************************************************
 * Licensed Materials - Property of IBM
 * Â© Copyright IBM Corporation 2019, 2021. All Rights Reserved.
 * 
 * Note to U.S. Government Users Restricted Rights:
 * Use, duplication or disclosure restricted by GSA ADP Schedule
 * Contract with IBM Corp.
 *******************************************************************************/
require(["i18n!nls/messages","common/request"],$.proxy(function(a,b){"use strict";function c(){$("#domain-select").find("option").remove(),$("#domain-collapsible-panel").slideUp("slow"),$("#domain-twistie").removeClass().addClass("filter-closed"),$("#chosen-domain-label").text(a.WebUI_No_Domain_Chosen)}function d(){$("#search-project-input").val(""),$("#project-select").find("option").remove(),$("#project-twistie").removeClass().addClass("filter-closed"),$("#project-collapsible-panel").slideUp("slow"),$("#chosen-project-label").text(a.WebUI_No_Project_Chosen),$("#clear-project-search").click()}function e(){$("#search-component-input").val(""),$("#component-select").find("option").remove(),$("#component-twistie").removeClass().addClass("filter-closed"),$("#component-collapsible-panel").slideUp("slow"),$("#chosen-component-label").text(a.WebUI_No_Component_Chosen),$("#clear-component-search").click()}function f(){$("#search-configuration-input").val(""),$("#configuration-select").find("option").remove(),$("#configuration-twistie").removeClass().addClass("filter-closed"),$("#configuration-collapsible-panel").slideUp("slow"),$("#chosen-configuration-label").text(a.WebUI_No_Configuration_Chosen),$("#clear-configuration-search").click()}function g(){l();var a=t;a=a.substring(0,a.indexOf("endpoint/")),a+="metamodelInfoFetch?opType=userProjects&endpoint="+encodeURIComponent(t)+"&resource=";var c=new b({url:a,contentType:b.ContentType.XML});c.send(function(a){a.data&&($(a.data).find("Project").each(function(){var a=$(this).attr("projectTypes"),b=$(this).attr("id"),c=$(this).text();"GC"!=a||b in o||(o[b]=c),a.indexOf("RTC")>-1&&!(b in p)&&(p[b]=c),a.indexOf("RQM")>-1&&!(b in q)&&(q[b]=c),a.indexOf("RRC")>-1&&!(b in r)&&(r[b]=c)}),Object.keys(o).length>0&&h("GC"),Object.keys(p).length>0&&h("RTC"),Object.keys(q).length>0&&h("RQM"),Object.keys(r).length>0&&h("RM"),i($("#domain-select :selected").attr("name")),$("#chosen-domain-label").text($("#domain-select :selected").text()),$("#domain-twistie").removeClass().addClass("filter-open"),$("#domain-collapsible-panel").slideDown("10"))})}function h(b){0==$("#domain-select option[value="+b+"]").length&&("GC"==b?$("#domain-select").append($("<option></option>").attr("name",b).text(a.WebUI_GC_Name)):"RTC"==b?$("#domain-select").append($("<option></option>").attr("name",b).text(a.WebUI_RTC_Name)):"RQM"==b?$("#domain-select").append($("<option></option>").attr("name",b).text(a.WebUI_QM_Name)):"RM"==b&&$("#domain-select").append($("<option></option>").attr("name",b).text(a.WebUI_RM_Name)))}function i(a){var b;$("#project-select").find("option").remove(),a.indexOf("GC")>-1?b=o:a.indexOf("RTC")>-1?b=p:a.indexOf("RQM")>-1?b=q:a.indexOf("RM")>-1&&(b=r),Object.keys(b).forEach(function(a,c){$("#project-select").append($("<option></option>").attr("URL",a).text(b[a]))});var c=$("#project-select option:selected").attr("URL");j(c)}function j(c){s={},$("#component-select").find("option").remove(),$("#component-select").append($("<option></option>").text(a.loading));var d=t;d=d.substring(0,d.indexOf("endpoint/")),d+="metamodelInfoFetch?opType=components&endpoint="+encodeURIComponent(t)+"&property=oslc_config:component&projectArea="+c;var e=new b({url:d,contentType:b.ContentType.XML});e.send(function(a){a.data?($("#component-select").find("option").remove(),$(a.data).find("Component").each(function(){var a=$(this).find("URI").text(),b=$(this).find("name").text();$(this).find("icon").text();$("#component-select").append($("<option></option>").attr({value:b,URL:a}).text(b.replace(/&amp;/g,"&"))),s[a]=b})):(404==a.status||400==a.status)&&($("#component-select").find("option").remove(),$("#component-select").append($('<option disabled="disabled" style="color:red;"></option>').text(a.responseText)))})}function k(){$("#configuration-select").find("option").remove(),$("#configuration-select").append($("<option></option>").text(a.loading));var c=$(document).data("reportViewUrl");if(void 0!=c&&c.indexOf("=")>-1&&c.indexOf("view")>-1)var d=c.split("="),e=d[d.length-1];var f=t;if(f=f.substring(0,f.indexOf("endpoint/")),f+="metamodelInfoFetch?opType=configurations&endpoint="+encodeURIComponent(t)+"&property=oslc_config:configurations",$("#project-select option:selected").attr("URL")){var g=$("#project-select option:selected").attr("URL");f+="&projectArea="+g}if($(".component-selection-area").is(":visible")&&$("#component-select option:selected").attr("URL")){var h=$("#component-select option:selected").attr("URL");f+="&component="+h}if($("#search-configuration-input").val()&&"*"!==$("#search-configuration-input").val()){var i=$("#search-configuration-input").val();i.indexOf("\\")>-1&&(i=i.replace(/\\/g,"*")),f+="&searchString="+encodeURIComponent(i)}void 0!=e&&(f+="&reportId="+e);var j=new b({url:f,contentType:b.ContentType.XML});j.send(function(a){a.data?($("#configuration-select").find("option").remove(),$(a.data).find("Configuration").each(function(){var a=$(this).find("URI").text(),b=$(this).find("name").text();$(this).find("icon").text();$("#configuration-select").append($("<option></option>").attr({value:b,URL:a}).text(b.replace(/&amp;/g,"&")))})):(404==a.status||400==a.status)&&($("#configuration-select").find("option").remove(),$("#configuration-select").append($('<option disabled="disabled" style="color:red;"></option>').text(a.responseText)))})}function l(){c(),d(),e(),f(),m(!1),$("#component-selection-area").addClass("notClickable"),$("#configuration-selection-area").addClass("notClickable"),$("#config-warning").show()}function m(a){window.postMessage({key:"enableChooseConfiguration",value:a},"*")}function n(a){window.postMessage({key:"chosenConfiguration",value:a},"*")}var o={},p={},q={},r={},s={};document.body.addEventListener("keydown",function(a){9===a.keyCode&&document.body.classList.add("using-keyboard")}),document.body.addEventListener("mousedown",function(){document.body.classList.remove("using-keyboard")});var t=null,u=$("#query-endpoint");if(u&&(t=u.val()),t||(t=__queryEndpoint),t||(t=window.location.href,t&&(t=t.replace("?showCreateSuccess",""))),t){var v=window.navigator.userAgent;if(v.indexOf("Trident/")>0)g();else{var w=!1,x=document.getElementById("choose-configuration-modal"),y=new MutationObserver(function(a){w||a.forEach(function(a){"attributes"==a.type&&"aria-hidden"==a.attributeName&&x&&"false"==x.getAttribute("aria-hidden")&&(w=!0,g())})});y.observe(x,{attributes:!0})}$("#domain-select").change(function(){d(),e(),f();var a=$("#domain-select :selected").attr("name");i(a),m(!1),$("#chosen-domain-label").text($("#domain-select :selected").text()),$("#component-selection-area").addClass("notClickable"),$("#configuration-selection-area").addClass("notClickable"),$("#config-warning").show()}),$("#project-select").change(function(){e(),f();var b=$("#project-select :selected").attr("URL");$("#chosen-project-label").text($("#project-select :selected").text()),j(b),m(!1),$("#chosen-project-label").text()!==a.WebUI_No_Project_Chosen&&($("#component-selection-area").removeClass("notClickable"),$("#configuration-selection-area").removeClass("notClickable"),$("#config-warning").hide())}),$("#component-select").change(function(){f(),$("#chosen-component-label").text($("#component-select :selected").text()),$("#chosen-configuration-label").text(a.WebUI_No_Configuration_Chosen),m(!1)}),$("#configuration-select").change(function(){$("#chosen-configuration-label").text($("#configuration-select :selected").text()),m(!0),n({name:$("#configuration-select :selected").text(),url:$("#configuration-select :selected").attr("URL")})}),$("#domain-selection-area").click(function(){$("#domain-twistie").toggleClass("filter-closed filter-open"),$("#component-collapsible-panel").slideUp("slow"),$("#project-collapsible-panel").slideUp("slow"),$("#configuration-collapsible-panel").slideUp("slow"),$("#project-twistie").removeClass().addClass("filter-closed"),$("#component-twistie").removeClass().addClass("filter-closed"),$("#configuration-twistie").removeClass().addClass("filter-closed"),$("#domain-collapsible-panel").slideToggle("10")}),$("#configuration-selection-area").click(function(){$("#domain-collapsible-panel").slideUp("slow"),$("#component-collapsible-panel").slideUp("slow"),$("#project-collapsible-panel").slideUp("slow"),$("#configuration-collapsible-panel").slideToggle("slow"),$("#configuration-twistie").toggleClass("filter-closed filter-open"),$("#project-twistie").removeClass().addClass("filter-closed"),$("#component-twistie").removeClass().addClass("filter-closed"),$("#domain-twistie").removeClass().addClass("filter-closed")}),$("#component-selection-area").click(function(){$("#domain-collapsible-panel").slideUp("slow"),$("#configuration-collapsible-panel").slideUp("slow"),$("#project-collapsible-panel").slideUp("slow",function(){$("#component-collapsible-panel").slideToggle("slow")}),$("#component-twistie").toggleClass("filter-closed filter-open"),$("#configuration-twistie").removeClass().addClass("filter-closed"),$("#project-twistie").removeClass().addClass("filter-closed"),$("#domain-twistie").removeClass().addClass("filter-closed")}),$("#project-selection-area").click(function(a){$("#domain-collapsible-panel").slideUp("slow"),$("#configuration-collapsible-panel").slideUp("slow"),$("#component-collapsible-panel").slideUp("slow",function(){$("#project-collapsible-panel").slideToggle("slow")}),$("#project-twistie").toggleClass("filter-closed filter-open"),$("#configuration-twistie").removeClass().addClass("filter-closed"),$("#component-twistie").removeClass().addClass("filter-closed"),$("#domain-twistie").removeClass().addClass("filter-closed")}),$("#search-project-input").keyup(function(a){var b=a.keyCode?a.keyCode:a.which;13==b&&$("#search-project-button").click()}),$("#search-project-button").click(function(){$("#project-select").find("option").remove();var a=$("#search-project-input").val();a=a.toUpperCase();var b={},c=$("#domain-select :selected").attr("name");c.indexOf("GC")>-1?b=o:c.indexOf("RTC")>-1?b=p:c.indexOf("RQM")>-1?b=q:c.indexOf("RM")>-1&&(b=r),Object.keys(b).forEach(function(c,d){var e=b[c].toUpperCase();(e.indexOf(a)>-1||"*"==a||""==a)&&$("#project-select").append($("<option></option>").attr("URL",c).text(b[c]))})}),$("#search-component-input").keyup(function(a){var b=a.keyCode?a.keyCode:a.which;13==b&&$("#search-component-button").click()}),$("#search-component-button").click(function(){$("#component-select").find("option").remove();var a=$("#search-component-input").val();a=a.toUpperCase(),Object.keys(s).length>0&&Object.keys(s).forEach(function(b,c){var d=s[b].toUpperCase();(d.indexOf(a)>-1||"*"==a)&&$("#component-select").append($("<option></option>").attr("URL",b).text(s[b].replace(/&amp;/g,"&")))})}),$("#deselect-component-option").click(function(){$("#component-select option").prop("selected",!1),$("#chosen-component-label").text(a.WebUI_No_Component_Chosen)}),$("#search-configuration-input").keyup(function(a){var b=a.keyCode?a.keyCode:a.which;13==b&&$("#search-configuration-button").click()}),$("#search-configuration-button").click(function(){k()}),$("#clear-project-search").click(function(){$("#search-project-input").val("")}),$("#clear-component-search").click(function(){$("#search-component-input").val("")}),$("#clear-configuration-search").click(function(){$("#search-configuration-input").val("")}),$("#domain-twistie").keydown(function(a){(13==a.which||32==a.which)&&$("#domain-selection-area").click()}),$("#project-twistie").keydown(function(a){(13==a.which||32==a.which)&&$("#project-selection-area").click()}),$("#component-twistie").keydown(function(a){(13==a.which||32==a.which)&&$("#component-selection-area").click()}),$("#configuration-twistie").keydown(function(a){(13==a.which||32==a.which)&&$("#configuration-selection-area").click()})}},this));