/***************************************************************************************************
 * Licensed Materials - Property of IBM Â© Copyright IBM Corporation 2005, 2020. All Rights
 * Reserved.
 * 
 * Note to U.S. Government Users Restricted Rights: Use, duplication or disclosure restricted by GSA
 * ADP Schedule Contract with IBM Corp.
 **************************************************************************************************/
define([],function(){function a(a){this._index=a,this._parent=null,this._children=[],this._peers=[],this.isIn=function(a){if(this._index===a)return!0;for(var b=0;b<this._peers.length;b++){var c=this._peers[b];if(c===a)return!0}return!1},this.normalize=function(){var a=[this._index].concat(this._peers).sort();return this._index=a[0],this._peers=a.slice(1),this},this.index=function(){return this._index},this.parent=function(a){return a?(this._parent=a,this._parent.child(this),null):this._parent},this.child=function(a){for(var b=!1,c=0;c<this._children.length;c++){var d=this._children[c];if(a.index()===d.index())return b=!0,!1}b||this._children.push(a)},this.children=function(){var a=[];return this._children.forEach(function(b,c){a.push(b)}),a},this.hasChildren=function(){return this.children().length>0},this.hasParent=function(){return null!==this.parent()},this.addPeer=function(a){this._peers.push(a)},this.peers=function(){return this._peers},this.columns=function(){var a=[this.index()];return a.concat(this.peers())}}function b(a){for(var b=a;b>=0;b--){var c=g[b];if(c&&(c.hasParent()||c.hasChildren()))return c}return null}function c(a){var b={},c=[];return a.forEach(function(a){c.push({id:a["@id"],position:parseInt(a.dataItemPosition),queryDataItem:a})}),c.sort(function(a,b){return a.position<b.position?-1:a.position>b.position?1:0}),c.forEach(function(a,c){b[a.id]=a,a.index=c}),c.forEach(function(a,c){var d=a.queryDataItem.groupSpanBy;a.spanByIndex=d?b[d].index:-1}),c}function d(d){i=c(d);var e=this;i.forEach(function(b,c){g[c]=new a(c,e)}),i.forEach(function(a,b){var c=g[b],d=a.spanByIndex;if(-1!==d){var e=g[d];c.parent(e)}}),i.forEach(function(a,c){var d=g[c];if(!d.hasParent()&&!d.hasChildren()){var e=b(c);e&&(e.addPeer(c),delete g[c])}}),this.eachLevel(function(a,b){return!a.hasParent()&&a.hasChildren()?(h=a,!1):void 0});var f;if(null===h)for(h=g[0]=new a(0,e),f=1;f<i.length;f++)h.addPeer(f);else for(f=h.index()-1;f>=0;f--)h.addPeer(f);this.eachLevel(function(a,b){a.normalize()})}function e(a,b){var c=[];return $.each(b.columns(),function(b,d){var e=a[d],f=$(e),g=f.text(),h=f.find("a");if(h.length>0){var i=$(h[0]);g=i.prop("href")}g&&0!==g.length||(g="&nbsp;"),c.push(g)}),c}function f(a,b){if(a.length!=b.length)return!1;for(var c=0;c<a.length;c++)if(a[c]!==b[c])return!1;return!0}var g={},h=null,i=[],j=d.prototype;return j.getRoot=function(){return h},j.getColumns=function(){return i},j.find=function(a){var b=null;return this.eachLevel(function(c){return c.isIn(a)?(b=c,!1):void 0}),b},j.eachLevel=function(a){for(var b in g)if(a(g[b],b)===!1)break},d.doSpan=function(a){a.find(".new-pagination-controls").remove();var b=a.find(".query-data-items"),c=b.find("td").html();if(c){var e=JSON.parse(c);b.remove();var f=a.find("tr"),g=new d(e);d._sortRows(a,g);var h=a.find("tr");d._collapseRows(h,0,h.length-1,g.getRoot());var i=h.find("[subsumed='true']");0===i.length?f.each(function(){a.append(this)}):i.remove()}},d._collapseRows=function(a,b,c,g){if(g){for(var h=g.index(),i=a[b],j=$(i).find("td"),k=e(j,g),l=-1,m=b,n=b+1;c>=n;n++){var o=$(a[n]),p=o.find("td");if(p.length>0&&h<p.length){var q=e(p,g);if(f(k,q))continue;var r=n-1;d._processRowGroup(a,m,r,g),l=r,k=q,m=n}}c>l&&d._processRowGroup(a,m,c,g)}},d._processRowGroup=function(a,b,c,e){var f=c-b+1;if(f>1){for(var g=e.columns(),h=0;h<g.length;h++){var i=g[h],j=$(a[b]),k=j.find("td");$(k[i]).attr("rowSpan",f);for(var l=b+1;c>=l;l++){var m=$(a[l]),n=m.find("td");$(n[i]).attr("subsumed","true")}}for(var o=e.children(),p=0;p<o.length;p++)d._collapseRows(a,b,c,o[p])}},d._sortRows=function(a,b){function c(a,b){var c=a.find("td").get();return $(c[b]).text()}for(var d=a.find("tr").get(),e=[],f=b.getRoot();;){if(e.push(f.index()),!f.hasChildren())break;f=f.children()[0]}d.sort(function(a,b){for(var d=0;d<e.length;d++){var f=c($(a),d),g=c($(b),d);if(g>f)return-1;if(f>g)return 1}return 0}),$.each(d,function(b,c){a.append(c)})},d});