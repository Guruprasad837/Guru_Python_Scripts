/*******************************************************************************
 * Licensed Materials - Property of IBM
 * Â© Copyright IBM Corporation 2014, 2021. All Rights Reserved.
 * 
 * Note to U.S. Government Users Restricted Rights:
 * Use, duplication or disclosure restricted by GSA ADP Schedule
 * Contract with IBM Corp.
 *******************************************************************************/
define(["common/templates","common/htmlUtils","i18n!nls/messages","queries/vocabularies","common/tooltipUtils"],function(a,b,c,d,e){function f(b){this.templates=new a(this),this.$frame=this.templates.$inflate("parameter-frame",null),this.$heading.addClass("jrs-tighter"),this._rptParam=$.extend({},b.rptParam),this.hideFilterOp=!1,this.title(this._rptParam.title),b.init&&b.init(this),this.setErrorState(!1),this._config=b}var g=d.SR;return f.prototype.getHeight=function(){return 1},f.prototype.finalize=function(a){function b(a){return $("a.jrs-param-collapse-link[href=\\#"+a+"] span:nth-child(2)")}this.$filterToggleLink.attr("href","#"+a).css("text-decoration","none"),this.$filterToggle.attr("id",a);var c=this;this.$filterToggle.on("shown.bs.collapse",function(){c.onShown&&c.onShown()}),this.$filterToggle.on("show.bs.collapse",function(){var a=$(this).parent().find(".filter-closed");c.columnId&&(a=b($(this).attr("id"))),a.removeClass("filter-closed").addClass("filter-open"),c.onShow&&c.onShow()}),this.$filterToggle.on("hide.bs.collapse",function(){var a=$(this).parent().find(".filter-open");c.columnId&&(a=b($(this).attr("id"))),a.removeClass("filter-open").addClass("filter-closed")})},f.prototype.showAsInline=function(a){this.$paramContent.css("margin-left",a?"0px":"30px");var b=this.inlineTitle;a||(b=this.isMerged||this.merged?this.originalTitle+" ("+this.inlineTitle+")":this.originalTitle),this.title(b),this.$filterToggle.removeClass("in"),this.$filterToggleLink.find(".filter-open").removeClass("filter-open").addClass("filter-closed"),a||this.widget().width("calc( 100% - 5px)")},f.prototype.filters=function(){var a=[this];return this.merged&&(a=a.concat(this.merged)),a},f.prototype.addRunLinks=function(){this.$inlineRunLinks&&this.$inlineRunLinks.remove(),this.$inlineRunLinks=this.templates.$inflate("run-inline-filter-links",null),this.$frame.append(this.$inlineRunLinks)},f.prototype.showContent=function(a){var b=$(this.$filterToggleLink.attr("href"));void 0===a?b.collapse("toggle"):b.collapse(a?"show":"hide")},f.prototype.getRunValues=function(){var a=this._config.gadget.getPrefValues(!0),b=this.getDisplayValues(a.values[this.getQueryVariable()]||[]);return e.setTooltipPopoverOptions(this.$frame),this.formatDisplayValues(b)},f.prototype.formatDisplayValues=function(a){if($.isArray(a)){for(var d=a.length,f=[],h=0;d>h;h++)f[h]=b.encodeHtml(b.decodeHtml(a[h]));a=f.join(", ")}return a?this._rptParam.filterOperator?a="<var>"+this._rptParam.filterOperator+"</var>: "+a:this._rptParam.parameterKind&&g.uDateRangeKind===this._rptParam.parameterKind||(a="<var>"+c.filters+"</var>: "+a):(a="<em>"+c.noFilter+"</em>",this._rptParam.noDefaults||(a="<span class='jrs-param-values-defaults'>"+a+": "+c.defaultChoices,this.$hdrEdit&&this.$hdrEdit.length>0&&"column-filter"==this.$hdrEdit[0].className||(a+=this._rptParam.title&&this._rptParam.title===c.WebUI_LimitScope_Tooltip1?e.getTooltipPopoverHTML(c.defaultChoicesTooltipForLimitTheScope,c.defaultChoicesTitle)+"</span>":e.getTooltipPopoverHTML(c.defaultChoicesTooltip,c.defaultChoicesTitle)+"</span>"))),a=a.replace(/&amp;#47;/g,"&#47;")},f.prototype.showDisplayValues=function(a,b){var c=void 0!=b?b:this.getDisplayValues(a);return c=this.formatDisplayValues(c),this.$paramValues.html(c),e.setTooltipPopoverOptions(this.$frame),c},f.prototype.updateRequired=function(a){this.$heading.attr("isRequired")&&(a===!0?this.$heading.find(".wasRequired").addClass("required").removeClass("wasRequired"):this.$heading.find(".required").addClass("wasRequired").removeClass("required"))},f.prototype.updateWarning=function(a){if(this.$heading.attr("isRequired"))if(a===!0)$("#_FilterAlert").show();else{var b=!0;$("div[isrequired = true]:visible").each(function(){return $(this).find(".required").length>0?(b=!1,!1):void 0}),b&&$("#_FilterAlert").find(".close").click()}},f.prototype.title=function(a){return a&&(this.$paramTitle.html(a),this.$paramTitleSR.html(a)),this._rptParam.title},f.prototype.setErrorState=function(a){a?this.$frame.removeClass("panel-info"):(this.$frame.removeClass("panel-danger"),this.isRequired()?(this.$frame.find(".jrs-param-heading .required").text("*"),this.$frame.find(".jrs-param-heading").attr("isRequired",!0)):this.$frame.find(".jrs-param-heading .required").text("  "))},f.prototype.markModified=function(a){this.$frame.find(".jrs-param-heading .modified").text(a?"*":"")},f.prototype.modified=function(a){return void 0!==a&&(this._modified=a,this.markModified(a)),this._modified},f.prototype.contents=function(a){this.$paramContent.replaceContents(a),this.isLoaded=!0,this._config.gadget.isOpenSocial()&&($(".gadget-input-xs").removeClass(".gadget-input-xs").addClass("input-xs"),$(".gadget-input-group-xs").removeClass(".gadget-input-group-xs").addClass("input-group-xs"))},f.prototype.destroy=function(){return this.$frame.remove()},f.prototype.widget=function(){return this.$frame},f.prototype.enableDesignMode=function(){this.$_designGroup.removeClass("hide")},f.prototype.isRequired=function(){return this._rptParam.required},f.prototype.noDefaults=function(){return this._rptParam.noDefaults},f.prototype.makeRequired=function(a){var b=this._rptParam.required;return this._rptParam.required=a,this.setErrorState(!1),b},f.prototype.getQueryVariableKind=function(){var a=this._rptParam.reportQueryVariableKind;return a?a:g.uReportableRestKind},f.prototype.getQueryVariable=function(){return this._rptParam.reportQueryVariable},f.prototype.getDisplayValues=function(){return this.getValues()},f.prototype.getFilteringValues=function(){return this.getValues()},f.prototype.getTemplateFilterString=function(){var a=[],b=this.getFilteringValues();if(null==b)return null;var c=this.getQueryVariable();return $.each(b,function(b,d){d&&(d=d.replace(/\$/g,"\\$"),a.push($.expand("pName=${0}&pVal=${1}",[encodeURIComponent(c),encodeURIComponent(d)])))}),0==a.length?null:a.join("&")},f.buildQueryFilter=function(a,c,d){if(null==c)return null;var e="__daterangeParm__";if(2==c.length&&0==c[0].indexOf(e)){var f=c[0].substring(e.length,c[0].length),g=c[1];return f&&g?"("+a+">='"+f+"' and "+a+"<='"+g+"')":f?"("+a+">='"+f+"')":g?"("+a+"<='"+g+"')":null}var h="=",i=!1;switch(d){case"is":case"is any of":h="=";break;case"is in subtree":h="=1";break;case"is any of selected or immediate children":h="=2";break;case"is not":case"is not any of":h="!=",i=!0;break;case"is not in subtree":h="!=1",i=!0;break;case"is not any of selected nor immediate children":h="!=2",i=!0;break;case"contains":h="=~";break;case"does not contain":h="!=~",i=!0;break;case"starts with":case"greater than":h=">";break;case"greater than or equals":h=">=";break;case"ends with":case"less than":h="<";break;case"less than or equals":h="<="}var j=[];return $.each(c,function(c,d){d=b.encodeHtml(d),d&&""!==d&&"IS_NULL"!==d?j.push($.expand("${0}${1}'${2}'",[a,h,d])):(j.push($.expand("${0}${1}'${2}'",[a,i?"!=":"=","IS_NULL"])),j.push($.expand("${0}${1}'${2}'",[a,i?"!=":"=",""])))}),0==j.length?null:"("+j.join(i?" and ":" or ")+")"},f.prototype.isInReportQuery=function(){return void 0===this._rptParam.inReportQuery?!0:0!=this._rptParam.inReportQuery},f.prototype.getQueryFilterString=function(a){var b=this.getQueryVariable();if(void 0===a)a=!1;else if("string"==typeof a)b=a;else if(a===!0&&!this.isInReportQuery())return null;return f.buildQueryFilter(b,this.getFilteringValues())},f.prototype.getConfigurationFilterString=function(a){var b=[],c=this.getFilteringValues();return null==c?null:$.isArray(c)&&1==c.length&&"auto"===c[0]?a&&"unset"!==a?"oslc_config.context="+encodeURIComponent(a):null:($.each(c,function(a,c){b.push($.expand("oslc_config.context=${0}",[encodeURIComponent(c)]))}),0==b.length?null:b.join("&"))},f.prototype.loadFromOSValues=function(a){var b=a?a.values:void 0;if(b){var c=b[this.getQueryVariable()];this.setSelectedValues(c?c:[])}},f.prototype.setSelectedValues=function(a){this.preselectedValues=a},f.prototype.isConfigurationParameter=function(){return this._rptParam.reportQueryVariableKind===g.uConfigurationPickerKind},f.prototype.isComponentParameter=function(){return this._rptParam.parameterQuery&&this._rptParam.parameterQuery.indexOf("property=oslc_config%3Acomponent")>0},Date.prototype.toISODateString=function(){try{var a=this.getFullYear(),b=this.getMonth()+1,c=this.getDate();return a+"-"+(10>b?"0"+b:""+b)+"-"+(10>c?"0"+c:""+c)}catch(d){return""}},Date.prototype.isValid=function(){return!isNaN(this.valueOf())},f.prototype.setFilterOperator=function(a){return this._rptParam.filterOperator=a},f});