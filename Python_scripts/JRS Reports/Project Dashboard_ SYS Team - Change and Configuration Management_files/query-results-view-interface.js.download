/*******************************************************************************
 * Licensed Materials - Property of IBM
 * Â© Copyright IBM Corporation 2014, 2021. All Rights Reserved.
 * 
 * Note to U.S. Government Users Restricted Rights:
 * Use, duplication or disclosure restricted by GSA ADP Schedule
 * Contract with IBM Corp.
 *******************************************************************************/
define(["chart/oneUIColours","queries/vocabularies","common/htmlUtils","common/item-cloud","common/uriUtils","common/etags","chart/chartDefaults"],function(a,b,c,d,e,f){var g=b.SR;return{get reportTitle(){return $("#resource-title").val()},set reportTitle(a){if("string"==typeof a){var b=c.decodeHtml(a);$("#resource-title").val(b)}else if(a){var b=c.decodeHtml(a["@value"]);$("#resource-title").val(b)}},get reportDescription(){return $("#resource-description").val()},set reportDescription(a){if("string"==typeof a){var b=c.decodeHtml(a);$("#resource-description").val(b)}else if(a){var b=c.decodeHtml(a["@value"]);$("#resource-description").val(b)}},get contributor(){var a=d.inst($("#report-contribs-container"));return a.getItems()},set contributor(a){if(a){"string"==typeof a&&(a=[a]);var b=d.inst($("#report-contribs-container"));0!==b.collection.models.length&&b.collection.models.length!==a.length?b.collection.reset():0!==b.collection.models.length&&b.collection.models.forEach(function(c){-1===a.indexOf(c.id)&&b.collection.reset()}),e.resolveUsers(a,function(a){a.collection.forEach(function(a){b.collection.add({id:a.uri,title:a.name})}),$("#report-owners-desc")[0].innerHTML=JSON.stringify(a)})}},get folderInfo(){var a=$("#report-folder-display").data("folder-json");return a},set folderInfo(a){return a?void(a.displayName&&a.id&&a.uri&&a.path||"/"===a.displayName?($("#report-folder-display").data("folder-json",a),"/"===a.displayName?$("#report-folder-display").css({display:"block","font-weight":"bold"}).text(a.displayName):$("#report-folder-display").css({display:"block","font-weight":"bold"}).text(a.path)):a.displayName&&a.id&&a.uri?($("#report-folder-display").data("folder-json",a),$("#report-folder-display").css("display","block").text(a.uri)):a.id?($("#report-folder-display").data("folder-json",a),$("#report-folder-display").css("display","block").text(a.id),e.getFolderInfoJSON(!0,a.id,function(a,b,c){if(a){$("#report-folder-display").data("folder-json",a);var d=e.getCompletePath(a.id);d?$("#report-folder-display").css({display:"block","padding-bottom":"7px","font-weight":"bold"}).text(d):a.uri&&$("#report-folder-display").css("display","block").text(a.uri)}})):a.uri&&($("#report-folder-display").data("folder-json",a),$("#report-folder-display").css("display","block").text(a.uri),e.getFolderInfoJSON(!0,e.getIndexFromURL(a.uri),function(a,b,c){if(a){$("#report-folder-display").data("folder-json",a);var d=e.getCompletePath(a.id);d&&$("#report-folder-display").css({display:"block","padding-bottom":"7px","font-weight":"bold"}).text(d)}}))):void console.error("ERROR! Invalid folder info")},get etag(){var a=$(document).data(f.HEADER);return a?a:""},set etag(a){$(document).data(f.HEADER,a)},set creator(a){e.resolveUsers([a],function(a){(a||a.collection||0!==a.collection.length)&&$("#report-creator").html(c.encodeHtml(a.collection[0].name))})},get tags(){for(var a=$("#resource-tags-select")[0].options,b=[],c=0,d=a.length;d>c;c++)a[c].value&&a[c].value.length>0&&b.push(a[c].value);return b},set tags(a){for(;$("#resource-tags-select")[0].options.length;)$("#resource-tags-select")[0].remove(0);if(a&&!(a.length<1)){"string"==typeof a&&(a=[a]);for(var b=0;b<a.length;b++){var c=new Option(a[b],a[b]);$("#resource-tags-select")[0].add(c)}}},get reportVisibility(){return $("#resource-visibility").val()},set reportVisibility(a){$("#resource-visibility").val(a)},set parameterSectionVisibility(a){1==a?($("#parameters-frame").collapse("show"),this.parameterList&&this.parameterList.runQueries()):$("#parameters-frame").collapse("hide")},get parameterList(){return $("#parameters-content").data("report-parameters")},set parameterList(a){$("#parameters-content").data("report-parameters",a)},get reportFilters(){return this.parameterList?this.parameterList.getFilterString():""},get reportParameters(){return this.parameterList?this.parameterList.getReportParameters():[]},set reportParameters(a){this.parameterList&&this.parameterList.loadParameters(a)},checkUnusedTemplateVars:function(a){if(this.parameterList){var b=this.parameterList.findUnusedTemplateVariables(templateVariables);if($.clearAlert(),b.length>0){var c=a.unusedTemplateVariables.replace("{0}",b.join(","));$.setAlert("warn",c)}}},get currentlyVisibleReportType(){return this.isTable?"table":this.isChart?this.chartType:void 0},set currentlyVisibleReportType(a){"table"==a?$("#results-tabs a[href='#queryTableTab']").click():$("#results-tabs a[href='#queryChartTab']").click()},get reportTypes(){var a={table:!1,chart:!1},b=this.currentlyVisibleReportType;if("table"==b)return a.table=!0,a;if(b)return a.chart=b,a;var c=this.generateResourceFor;return a.table="table-only"==c||"table-chart"==c,("chart-only"==c||"table-chart"==c)&&(a.chart=this.chartType),a},set reportTypes(a){},get defaultTableVisualization(){return $(document).data("default-visualization-table")},set defaultTableVisualization(a){$(document).data("default-visualization-table",a)},get isTable(){return"none"!=$("#tableResults").css("display")?!0:!1},set isTable(a){},get isChart(){return"none"!=$("#chartConfiguration").css("display")?!0:!1},set isChart(a){},get chartType(){return $("#chart-select-button").data("jazz.current.value")},set chartType(a){$("#chart-select-button").data("jazz.current.value",a)},get tableColumns(){return resultVariables},set tableColumns(a){resultVariables=a},get paginationValue(){return $paginationPerPage=$(".pagination-items-per-page"),$paginationPerPage.length>0?parseInt($paginationPerPage[0].value):20},set paginationSize(a){},get chartSorting(){var a=$("#sort-select-button").data("jazz.current.value");return a?"top"==a?"DESC":"bottom"==a?"ASC":void 0:void 0},set chartSorting(a){var b="";a&&a.length&&("DESC"==a?b="top":"ASC"==a&&(b="bottom")),$("#sort-select-button").data("jazz.current.value",b)},get isHorizontal(){var a,b=$("#orientation-select-button").data("jazz.current.value");return"true"==b?a=!0:"false"==b&&(a=!1),a},set isHorizontal(a){a?$("#orientation-select-button").data("jazz.current.value","true"):$("#orientation-select-button").data("jazz.current.value","false")},get chartDateScaling(){return $("#scale-by-years").prop("checked")?g.nYears:$("#scale-by-weeks").prop("checked")?g.nWeeks:$("#scale-by-months").prop("checked")?g.nMonths:g.nDays},set chartDateScaling(a){a==g.nYears?$("#scale-by-years").prop("checked",!0):a==g.nWeeks?$("#scale-by-weeks").prop("checked",!0):a==g.nMonths?$("#scale-by-months").prop("checked",!0):a==g.nDays&&$("#scale-by-days").prop("checked",!0)},get chartDateNoValueZero(){return $("#date-scale-no-value-default").prop("checked")},set chartDateNoValueZero(a){$("#date-scale-no-value-default").prop("checked",a)},get categoryVariable(){return $("#category-select")[0]?$("#category-select")[0].value:void 0},set categoryVariable(a){$("#category-select")[0]&&($("#category-select")[0].value=a)},get categoryLabel(){var a=$("#category-select"),b=a[0].value,c=a.find("[value='"+b+"']");return c.text()},set categoryLabel(a){},get customChartTitle(){return $("#chart-title")[0]?$("#chart-title")[0].value:void 0},set customChartTitle(a){$("#chart-title")[0]&&($("#chart-title")[0].value=a)},get customGroupTitle(){return $("#group-title-textbox")[0]?$("#group-title-textbox")[0].value:void 0},set customGroupTitle(a){$("#group-title-textbox")[0]&&($("#group-title-textbox")[0].value=a)},get customCountTitle(){return $("#count-title-textbox")[0]?$("#count-title-textbox")[0].value:void 0},set customCountTitle(a){$("#count-title-textbox")[0]&&($("#count-title-textbox")[0].value=a)},get showValues(){return $("#graph-type-show-values").prop("checked")},set showValues(a){$("#graph-type-show-values").prop("checked",a)},get showTotals(){return $("#graph-type-show-totals").prop("checked")},set showTotals(a){$("#graph-type-show-totals").prop("checked",a)},get showGrids(){return $("#graph-type-show-grids").prop("checked")},set showGrids(a){$("#graph-type-show-grids").prop("checked",a)},get isSeriesForEachVariableValue(){var a=$("#seriesSelectByValue");return a.length>0?$("#seriesSelectByValue")[0].checked:!0},set isSeriesForEachVariableValue(a){$("#seriesSelectByValue")[0].checked=a,$("#seriesSelectByColumn")[0].checked=!a,$("#count-select").prop("disabled",!a),$("#series-select").prop("disabled",!a),$("#column-select").prop("disabled",a)},get isSeriesForResultColumns(){var a=$("#seriesSelectByColumn");return a.length>0?$("#seriesSelectByColumn")[0].checked:!1},set isSeriesForResultColumns(a){$("#seriesSelectByValue")[0].checked=!a,$("#seriesSelectByColumn")[0].checked=a,$("#count-select").prop("disabled",a),$("#series-select").prop("disabled",a),$("#column-select").prop("disabled",!a)},_setLineColor:function(a,b){var c=$(document).data("lineColor");c||(c={},$(document).data("lineColor",c)),c[a]=b},_getLineColor:function(a){var b=$(document).data("lineColor");return b?b[a]:null},get dataColors(){var b=this.seriesColumnsVariables;if(b&&0!=b.length||(b=[this.categoryVariable]),b){for(var c=b.length,d=function(a){return 16>a?"0"+Math.max(0,a).toString(16):Math.min(255,a).toString(16)},e=this.chartType,f=$.map(a.getRandomColoursArray(c,"stackedbarchart"==e),function(a,b){return"#"+d(a.r)+d(a.g)+d(a.b)}),g={},h=0,i=f.length;i>h;h++)g[f[h]]=!0;for(var h=0;c>h;h++){var k=this._getLineColor(b[h]);g[k]&&delete g[k]}f=[];for(prop in g)f.push(prop);j=0;for(var l={},h=0;c>h;h++)(!this._getLineColor(b[h])||l[this._getLineColor(b[h])])&&this._setLineColor(b[h],f[j++]),"linechart"===e||Object.values(this.seriesGraphType).includes("line")||"stackedbarchart"===e||"groupedbarchart"===e||(l[this._getLineColor(b[h])]=!0)}return $(document).data("lineColor")},set dataColors(a){if(a){var b=$(".graph-rows");if(a instanceof Object)for(key in a)this._setLineColor(key,a[key]),b.length>0&&($colorPicker=b.find(".colorPicker"),$colorPicker.each(function(){var b=$(this);key==b.attr("data-key")&&b.attr("data-color",a[key])}));if(b.length>0){var c=b.find(".colorPicker"),d=this;c.each(function(){var b=$(this),c=b.attr("data-key");a[c]||d._setLineColor(c,b.attr("data-color"))})}}else $(document).data("lineColor",{})},_getSeriesEnumValue:function(a,b){var c={};if($valsEl=$("."+a),0==$valsEl.length){var d=$(document).data(a);if(d)return d}var e=this.seriesColumnsVariables;if(!e||0==e.length)return $valsEl.each(function(){var a=$(this),b=a.attr("data-key");void 0!==b&&null!==b&&(c[b]=a.val())}),c;if(e)for(var f=e.length,g=0;f>g;g++){var h=b,i=$("."+a+"[data-key='"+e[g]+"']");i.length>0&&(h=i.val()),c[e[g]]=h}return c},_setSeriesEnumValue:function(a,b){for(var c in a){c=c.replace(/'/g,"\\'");var d=$("."+b+"[data-key='"+c+"']");d.length>0?a[c]&&!d.prop("disabled")&&d.val(a[c]):$(document).data(b,a)}},get seriesCalculation(){return this._getSeriesEnumValue("lineCalculation","avg")},set seriesCalculation(a){this._setSeriesEnumValue(a,"lineCalculation")},get seriesGraphType(){return this._getSeriesEnumValue("lineGraphType","default")},set seriesGraphType(a){this._setSeriesEnumValue(a,"lineGraphType")},get seriesGraphAxes(){return this._getSeriesEnumValue("graphYAxisType","Y")},set seriesGraphAxes(a){this._setSeriesEnumValue(a,"graphYAxisType")},get seriesSortOrder(){var a={},b=$(".graph-rows tbody").children(),c=0;if(0==b.length){var d=$(document).data("lineSortOrder");if(d)return d}return b.each(function(){var b=$(this).find(".drag-handle"),d=b.attr("data-key");a[d]=""+c++}),a},set seriesSortOrder(a){$(document).data("lineSortOrder",a)},get seriesLabels(){var a=[],b=this.seriesColumnsVariables;if(!b||0==b.length)return a;if(b)for(var d=b.length,e=0;d>e;e++){var f,g=$("#graphLineLabel"+b[e]);if(g.length>0)f=g.val();else{var h=resultVariables[b[e]];if(h)f=c.decodeHtml(h.label);else{var i=$("#column-select").find("option[value='"+b[e]+"']");f=i.length>0?i.text():b[e]}}a[b[e]]=f}return a},get seriesVariable(){return $("#series-select")[0]?$("#series-select")[0].value:void 0},set seriesVariable(a){$("#series-select")[0]&&($("#series-select")[0].value=a)},get seriesLabel(){var a=$("#series-select"),b=a[0].value,c=a.find("[value='"+b+"']");return c.text()},set seriesLabel(a){},get measureVariable(){return $("#count-select")[0]?$("#count-select")[0].value:void 0},set measureVariable(a){$("#count-select")[0]&&($("#count-select")[0].value=a)},get measureLabel(){var a=$("#count-select"),b=a[0].value,c=a.find("[value='"+b+"']");return c.text()},set measureLabel(a){},get seriesColumnsVariables(){for(var a=[],b=$("#column-select"),c=0==b.length?[]:b[0].options,d=0,e=c.length;e>d;d++)c[d].selected&&a.push(c[d]);for(var f=[],d=0,e=a.length;e>d;d++)f.push(a[d].value);return f},set seriesColumnsVariables(a){for(var b=$("#column-select")[0].options,c=0,d=b.length;d>c;c++){var e="#column-select option[value="+b[c].value+"]";$.inArray(b[c].value,a)>-1?$(e)[0].selected=!0:$(e)[0].selected=!1}},updateSeriesColumnsVariable:function(a,b){var c=$("#column-select"),d=c.find("option[value='"+a.replace(/'/g,"\\'")+"']");if(0==d.length){var d=$("<option value='"+a+"' title='"+b+"'>"+b+"</option>");0==a.indexOf("__GL__")||0==a.indexOf("__DL__")?(d.addClass("goalLine"),c.append(d)):-1!=$.inArray(d,c.find("option"))&&c.append(d)}},get seriesColumnsLabels(){},set seriesColumnsLabels(a){},get generateResourceFor(){return $("input:radio[name=source-content-selection]:checked").val()},set generateResourceFor(a){$("input:radio[name=source-content-selection]").val([a])},get turtleEditor(){return $("#turtle").val()},set turtleEditor(a){$("#turtle").val(a),$("#turtle").attr("defaultValue",a),this.isTurtleEditorDirty=!1},get isTurtleEditorDirty(){return $("#turtle").val()!=$("#turtle").attr("defaultValue")},set isTurtleEditorDirty(a){a?(this.isTurtleEditorDirty||$("#turtle").attr("defaultValue",""),$("#editor-dirty-tab").html("<em>*</em>")):($("#turtle").attr("defaultValue",this.turtleEditor),$("#editor-dirty-tab").html(""))}}});