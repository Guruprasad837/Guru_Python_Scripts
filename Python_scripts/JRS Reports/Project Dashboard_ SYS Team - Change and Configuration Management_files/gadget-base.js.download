/*******************************************************************************
 * Licensed Materials - Property of IBM
 * (c) Copyright IBM Corporation 2013, 2023. All Rights Reserved.
 * 
 * Note to U.S. Government Users Restricted Rights:
 * Use, duplication or disclosure restricted by GSA ADP Schedule
 * Contract with IBM Corp.
 *******************************************************************************/
define(["common/jquery-ext","common/request","common/bidiUtils","common/htmlUtils","common/tooltipUtils","common/customEvents","common/reportdefinition-parser","common/resizable-dialog","queries/query-results-view-interface","queries/vocabularies","parameters/parameter-list","gadget/span-hierarchy","common/tree-select","gadget/gadget-settings","colResizable/colResizable-1.6","i18n!nls/messages"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){function q(a){a?this.modal({backdrop:"static",keyboard:!1}):this.modal("hide")}function r(a){var b=i.parameterList;b&&b.each(function(b,c,d){b.runQuery||b.showDisplayValues(a)})}function s(){E.runButton&&E.runButton.trigger("click")}function t(b){E.filtersModal.showModal(b),E.filtersModal.visible=b,b&&a("#parameter-contents").collapse("hide")}function u(c,d){this.reportUrl=c,this.resizableDialog=h,this.onGoingEvents={},this.prefValues=null,this.request=new b({contentType:b.ContentType.TEXT,postPaths:["view/partial","numProjects","numComponents"]}),this.filterAlert=a("#_FilterAlert").asAlert(),this.reportAlert=a("#_ReportAlert").asAlert(),this.hostMode=d?u.Modes.Embedded:a.isOpenSocial()?u.Modes.OpenSocial:u.Modes.View,this._firstLoad=!0,this._loginToHost=null,f.install(this);var e=this;E.filtersModal.on("hide.bs.modal",function(a){if(a.target===E.filtersModal){var b=e.getParameterList();b.isModified()&&(a.preventDefault(),E.abandonModal.showModal(!0)),E.filtersModal.visible=!1}}),E.abandonOKButton.click(function(){e.refresh()}),this.on(u.Events.Executing,function(a){e.onGoingEvents[u.Events.Executing]=!0,v.call(e)}),this.on(u.Events.Executed,function(a){delete e.onGoingEvents[u.Events.Executing],v.call(e)}),this.on(u.Events.LoadingParameters,function(b){e.onGoingEvents[u.Events.LoadingParameters]=!0,v.call(e),G.spin(a("#show-parameters-spinner").get(0))}),this.on(u.Events.LoadedParameters,function(a){delete e.onGoingEvents[u.Events.LoadingParameters],v.call(e),G.stop()}),this.on(u.Events.Previewing,function(a){e.onGoingEvents[u.Events.Previewing]=!0,v.call(e)}),this.on(u.Events.Previewed,function(a){delete e.onGoingEvents[u.Events.Previewing],v.call(e)})}function v(){var a=this;0==_.keys(a.onGoingEvents).length?(E.$vizSelect.removeAttr("disabled"),E.saveButton.removeAttr("disabled"),E.runButton.removeAttr("disabled")):(E.$vizSelect.attr("disabled",!0),E.saveButton.attr("disabled",!0),E.runButton.attr("disabled",!0))}function w(b){if(b){var c=a("#gotoReport");if(c.length>0){var d=c[0].href.split("#"),e=d[0],f=d[1],g=a.queryToObject(f),h=b;b&&b.values&&b.values["oslc_config.context"]instanceof Array&&b.values["oslc_config.context"].length>0&&"auto"===b.values["oslc_config.context"][0]&&D&&0===D.indexOf("http")&&(h=jQuery.extend(!0,{},b),h.values["oslc_config.context"][0]=D),g.filterValues=this._buildFilterVarString(h),this.gadgetSettings.hasDefaultData()||(g.gs=JSON.stringify(this.gadgetSettings.data)),c.prop("href",e+"#"+a.objectToQuery(g))}}}var x="jrsPxyLgtd=true",y="Not allowed due to security",z="[]",A="selectedViz",B="rb-config-picker",C={"#_main":400,"#_login":200},D="unset",E={filtersModal:a("#param-modal"),runButton:a("#_paramsRunButton"),saveButton:a("#_paramsSaveButton"),$gadgetSettingsButton:a("#_paramsSettingsButton"),$gadgetSettingsContent:a("#gadget-settings-content"),clearButton:a("#_paramsClearButton"),editButton:a("#_paramsEditButton"),filtersToggleTwistie:a("#filters-toggle-twistie"),filtersToggle:a("#filters-toggle"),abandonModal:a("#abandon-modal"),abandonOKButton:a("#abandon-ok-button"),$vizSelect:a("#viz-select")};E.filtersModal.showModal=q,E.filtersModal.visible=!1,E.filtersToggleTwistie.isClosed=function(){return this.hasClass("filters-closed")},E.abandonModal.showModal=q;var F=!1;u.prototype.widgetContentSpinner=new Spinner({lines:10,length:7,width:2,radius:4,color:"#000",speed:1,trail:60,shadow:!1,zIndex:function(){var a=parseInt(E.filtersModal.css("z-index"));return NaN==a?void 0:a-1}()});var G=new Spinner({lines:10,length:7,width:2,radius:4,color:"#000",speed:1,trail:60,position:"relative",shadow:!1});return u.prototype.refresh=function(){this.parameterList.loadValues(this.getPrefValues(!0)),E.filtersModal.one("hidden.bs.modal",function(a){s()}),this._showParameters(!1)},u.prototype.showSection=function(b){a("[class=gadget-section]").addClass("hide"),a(b).removeClass("hide");var c=C[b];c&&this.setHeight(c)},u.prototype.showError=function(a){E.filtersModal.visible?this.filterAlert.show("error",a):this.reportAlert.show("error",a)},u.prototype.showWarning=function(a){E.filtersModal.visible?this.filterAlert.show("warn",a):this.reportAlert.show("warn",a)},u.prototype.showSuccess=function(a){E.filtersModal.visible?this.filterAlert.show("success",a):this.reportAlert.show("success",a)},u.prototype._showParameters=function(a){E.filtersToggleTwistie.isClosed()&&E.filtersToggle.trigger("click"),t(a),a&&this.getParameterList().hideFilters(),r()},u.prototype.getSectionHeight=function(a){return C[a]},u.prototype.showLoading=function(b){b?(a("#_visualization").hasClass("hide")&&a("#_visualization").removeClass("hide"),a("#jp-page-content").addClass("hide"),a("#loadingProgress").removeClass("hide"),this.widgetContentSpinner.spin(a("#widget-content-spinner")[0])):(this.widgetContentSpinner.stop(),a("#loadingProgress").addClass("hide"),a("#jp-page-content").removeClass("hide"))},a("#_loading").offon("hidden.bs.modal",function(){F=!1}),u.prototype.doProxyLogout=function(){var a=window.location.search;if(a&&a.indexOf(x)>-1)return void this.showError(__GadgetMessages.ProxyLogoutFailed);var b=__JTS_ROOT_URL,c=window.location.href,d=c.indexOf("web/services/gadgetRender?");-1!=d&&(b=c.substring(0,d));var e=document.createElement("IFRAME");e.setAttribute("src",b+"proxy/logout"),e.style.width="0px",e.style.height="0px",e.style.visibility="hidden",e.style.display="none",e.onload=function(){""===a?a="?":a+="&",a+=x,window.location.search=a},document.body.appendChild(e)},u.prototype.getPrefValues=function(b,c){if(this.hostMode===u.Modes.OpenSocial){if(!b&&this.prefValues)return this.prefValues;if(!this.hasSavedValues()&&this.reportDefaults)return this.reportDefaults;var d=new gadgets.Prefs,e=JSON.parse(d.getString("selectedParameters"));return e["oslc_config.dashboard"]===!0&&D&&(e["oslc_config.context"]=D),e}if(this.hostMode!==u.Modes.Embedded){var f=a.urlhash(parent),g=a.queryToObject(f).filterValues;if(!g||""==g){if(this.reportDefaults){var h=a.cookies.get(B);return h&&(this.reportDefaults.values["oslc_config.context"]=[h]),this.reportDefaults}return{}}return JSON.parse(g)}},u.prototype.getPrefGadgetSettings=function(b,c){if(this.hostMode!==u.Modes.Embedded){var d=a.urlhash(parent),e=a.queryToObject(d).gs;return e&&""!=e?JSON.parse(e):null}},u.prototype.setPrefValues=function(b){var c=this._buildFilterVarString(b);if(null==c)return this.showError(__GadgetMessages.TooManySelections),!1;var d,e;if(this.hostMode===u.Modes.OpenSocial){this.prefValues=b;var f=new gadgets.Prefs;return f.set("selectedParameters",JSON.stringify(b)),this.getParameterList().updateState(),!0}if(this.hostMode!==u.Modes.Embedded){b.values["oslc_config.context"]&&(d=b.values["oslc_config.context"],d&&a.cookies.set(B,d)),this.getParameterList().updateState();var g=a.urlhash(parent),h=a.queryToObject(g);if(e=this.reportDefinition.getDefinition().identifier,d&&e&&g){var i,j=g.indexOf("/");if(-1!==j){var k=g.indexOf("/",j+1);k>j&&(i=g.substring(j+1,k))}else{var l=g.indexOf("=");-1!==l&&(i=g.substring(l+1))}var m=window.parent.jQuery("#create-report-page");i?m.data("rb-config-picker",e+","+i+":"+d):m.removeData("rb-config-picker")}return h.filterValues=c,this.gadgetSettings.hasDefaultData()||(h.gs=JSON.stringify(this.gadgetSettings.data)),parent.location.hash="#"+a.objectToQuery(h),!0}},u.prototype.getUserPref=function(a){if(this.hostMode===u.Modes.OpenSocial){var b=new gadgets.Prefs;return b.getString(a)}},u.prototype.setUserPref=function(a,b){if(this.hostMode===u.Modes.OpenSocial){var c=new gadgets.Prefs;c.set(a,b)}},u.prototype.clearPrefValues=function(b){if(this.hostMode===u.Modes.OpenSocial){var c=new gadgets.Prefs;c.set("selectedParameters",z)}else if(this.hostMode!==u.Modes.Embedded){var d=a.queryToObject(a.urlhash(parent));delete d.filterValues,delete d.gs,parent.location.hash="#"+a.objectToQuery(d)}this.prefValues=null,this.loadFilters(!0,b),this.gadgetSettings.resetToDefaults()},u.prototype.hasSavedValues=function(){if(this.hostMode===u.Modes.OpenSocial){var b=new gadgets.Prefs;if(valuesStr=b.getString("selectedParameters"),!valuesStr||valuesStr===z||""===valuesStr)return!1}else if(this.hostMode!==u.Modes.Embedded){var c=a.urlhash(parent);if(valuesStr=a.queryToObject(c).filterValues,!valuesStr)return!1}return!0},u.prototype._buildFilterVarString=function(a){return JSON.stringify(a)},u.prototype.setHeight=function(a){if(this.hostMode===u.Modes.OpenSocial){var b=new gadgets.Prefs,c=b.getString("gadgetHeight");""!==c&&(c=parseInt(c),c>0&&(a=c)),gadgets.window.adjustHeight(a)}},u.prototype.getParameterList=function(){return this.parameterList},u.prototype.getReportDefinition=function(){return this.reportDefinition},u.prototype.loadFilters=function(a,b){var c=this.getParameterList();if(null!==c){var d=this;(this._firstLoad||a)&&(d.notify(u.Events.LoadingParameters),a||d.showLoading(!0),c.runQueries(function(){r(b),d._firstLoad=!1,a||d.showLoading(!1),setTimeout(function(){d.notify(u.Events.LoadedParameters)},50),c.updateState()},d.getPrefValues(!1,b),{performRefresh:a,revertValues:a}))}},u.prototype.check_lqe_auth=function(a,b){if(401===b.status){var c=b.substatus;if(c||(c=b.getResponseHeader?b.getResponseHeader("substatus"):""),""===c)this.doProxyLogout();else if("CRRGW5499E"===c||"CRRGW5320E"===c){var d={height:350,refresh:function(){window.location.reload()},noCancel:!0};return require(["common/lqeauth"],function(b){b.show(a,d)}),!0}}return!1},u.prototype._initRequest=function(){var c=this;this.request.on(b.Events.OAuthApprovalNeeded,function(b,d){var e=a.parseUrl(d.oauthApprovalUrl);if(e.host!==c._loginToHost){c._loginToHost=e.host,c.showLoading(!1);var f=new gadgets.oauth.Popup(d.oauthApprovalUrl,null,function(){c.showLoading(!0)},function(){c.showLoading(!1),c.showSection("#_main"),d.doNotReload!==!0&&window.location.reload()});return a("#_visualization").addClass("hide"),a("#_loginLink").get(0).onclick=f.createOpenerOnClick(),a("#_linkDescription").html(a.expand(__GadgetMessages.LoginDesc,[e.host])),c.showLoading(!1),c.showSection("#_login"),a("#_loginLink").click(),c.filterAlert.clear(),c.reportAlert.clear(),!0}c._loginToHost=null,c.doProxyLogout()}).on("HTTP-302",function(){c._loginToHost=null,c.doProxyLogout()}).on("HTTP-401",function(a,b){c._loginToHost=null;var d=b.request,e=b.response,f=d?d.substatus:void 0;if(!f){if(!b.headers||!b.headers.substatus)return c.doProxyLogout(),!0;f=b.headers.substatus}if("CRRGW5499E"===f||"CRRGW5320E"===f){var g={height:500,refresh:function(){window.location.reload()},noCancel:!0};require(["common/lqeauth"],function(a){a.show(e,g)})}return!0}).on("HTTP-307",function(a,b){c._loginToHost=null,c.doProxyLogout()})},u.prototype._initControls=function(){var b=this;if(a("#gotoReport").attr("href",a(document).data("reportViewUrl")),this.hostMode===u.Modes.OpenSocial);else if(this.hostMode!==u.Modes.Embedded){var c=window.parent.jQuery("#create-report-page"),d=c.find("#query-endpoint");if(d.length>0)var e=a(d[0].options[d[0].selectedIndex]),f=e.attr("data-hasRelatedDataWarehouse");"true"==f?a("#validate-query-results-button2").show():a("#validate-query-results-button2").hide();var g=a("#validate-query-results-button2");g.length>0&&g.on("click",function(a){g.attr("disabled",!0),c.off("compareQueryResultDone"),c.on("compareQueryResultDone",function(){g.attr("disabled",!1)}),c.trigger("compareQueryResult")})}var j=a("#export-excel-button");j.length>0&&j.on("click",function(c){var d=a(document).data("exportExcelUrl");if(b.filters&&(d+="&"+b.filters),b.ddFilters){d+="&"+b.ddFilters;var e={viz:b._vizMap[b._selectedViz]};if(e.viz){var f=e.viz["@id"],g=f.substring(__reportDefinitionUrl.length+1,f.length);d+="&dd=true&viz="+g}}var h=window.open(d,"_blank");h.focus()});var l=a("#schedule-export-button");l.length>0&&l.on("click",function(c){var d=a(document).data("createScheduleURL");if(b.filters&&(d+="&"+b.filters),b.ddFilters){d+="&"+b.ddFilters;var e={viz:b._vizMap[b._selectedViz]};if(e.viz){var f=e.viz["@id"],g=f.substring(__reportDefinitionUrl.length+1,f.length);d+="&dd=true&viz="+g}}var h=window.open(d,"_blank");window.gadget=b,h.focus()});var m=a("#export-rpe-button");m.length>0&&m.on("click",function(c){var d=a(document).data("exportRPEUrl");if(b.filters&&(d+="&"+b.filters),b.ddFilters){d+="&"+b.ddFilters;var e={viz:b._vizMap[b._selectedViz]};if(e.viz){var f=e.viz["@id"],g=f.substring(__reportDefinitionUrl.length+1,f.length);d+="&dd=true&viz="+g}}var h=window.open(d,"_blank");h.focus()});var m=a("#export-rpe-docgen-page-button");m.length>0&&m.on("click",function(c){var d=a(document).data("exportRPEDocGenPageUrl");if(b.filters&&(d+="&"+b.filters),b.ddFilters){d+="&"+b.ddFilters;var e={viz:b._vizMap[b._selectedViz]};if(e.viz){var f=e.viz["@id"],g=f.substring(__reportDefinitionUrl.length+1,f.length);d+="&dd=true&viz="+g}}var h=window.open(d,"_blank");h.focus()}),a("#param-modal").on("show.bs.modal",function(){b.hostMode===u.Modes.OpenSocial&&a(".modal-dialog.filters").addClass("gadget"),b.loadFilters()}),a("#param-modal").on("shown.bs.modal",function(){var b=a(".modal-backdrop").height()-40;a(".modal-body.filters").css("max-height",b),a("#param-modal").css({"padding-left":"0px",overflow:"auto"}),window.parent.document.getElementById("runReportTab")&&(window.parent.document.getElementById("runReportTab").style.height=window.parent.innerHeight-window.parent.$("#run-report-frame").offset().top+25+"px"),window.parent.document.getElementById("view-report-frame")&&(window.parent.document.getElementById("view-report-frame").style.height=window.parent.innerHeight-window.parent.$("#view-frame").offset().top+25+"px")}),a("#param-modal").on("hidden.bs.modal",function(){window.parent.document.getElementById("runReportTab")&&(window.parent.document.getElementById("runReportTab").style.height=window.parent.innerHeight-window.parent.$("#run-report-frame").offset().top+25+"px"),window.parent.document.getElementById("view-report-frame")&&(window.parent.document.getElementById("view-report-frame").style.height=window.parent.innerHeight-window.parent.$("#view-frame").offset().top+25+"px"),E.$gadgetSettingsContent.hide()}),a("#filters-toggle").click(function(){var a=E.filtersToggleTwistie;a.hasClass("filters-closed")?a.removeClass("filters-closed").addClass("filters-open"):(a.removeClass("filters-open").addClass("filters-closed"),E.$gadgetSettingsContent.is(":visible")&&E.$gadgetSettingsContent.hide())}),a("#skipping-alert-close").click(function(){a("#skipping-resource-alert-section").hide()}),a("#skipping-resource-detail-expand").click(function(){a("#skipping-resource-detail").is(":visible")?(a("#skipping-resource-detail").hide(),a("#skipping-resource-detail-expand").text(p.Skipping_Resources_Showmore)):(a("#skipping-resource-detail").show(),a("#skipping-resource-detail").css("display","inline-block"),a("#skipping-resource-detail-expand").text(p.Skipping_Resources_Showless))}),E.runButton.reclick(function(){b.runPreview(!1)}),a("#_loading").offon("hidden.bs.modal",function(){F=!1}),E.clearButton.reclick(function(c){b.clearPrefValues(c),a("div[isrequired = true]").each(function(){0==a(this).next().find("#choose-configuration").length&&a(this).find(".wasRequired").addClass("required").removeClass("wasRequired")});var d=!0;a("div[isrequired = true]").each(function(){a(this).find(".required").length>0&&(d=!1)}),d||a("#_FilterAlert").show()}),E.saveButton.reclick(function(){var c=b.parameterList;if(c){if(!c.hasAllRequiredValues())return void b._showMissingRequiredValueMessage();var d=c.getSelectedValues();b.setPrefValues(d)&&(b._showParameters(!1),b.filters=void 0,a(".save-changes").is(":disabled")?b.runPreview(!0):b.runPreview(!1))}});var n=this.hostMode===u.Modes.OpenSocial?2:4;this.parameterList=i.parameterList=new k({gadget:b,containerId:"#parameters-content",designMode:!1,inlineRun:function(){s()},itemsPerRow:n,gutter:3}),this.parameterList.setReportQBO(__reportQBO),a("#param-modal .resizable").each(function(a,b){h.handleDialogResize(b)})},u.prototype.loadContent=function(b,c,e,f){var g=this;a("#skipping-resource-alert-section").hide(),this.request.setUrl(c).send(function(c){var h=c.data;g._loginToHost=null,h?(g.showLoading(!1),g.reportAlert.clear(),a("#_visualization").removeClass("hide"),b.html(d.decodeUTF8(h)),e&&e(),g.addSkippingResources(c.xhr)):(g.showLoading(!1),f&&f(),c.oauthErrorText?c.oauthError&&c.oauthErrorText.indexOf(y)>-1?g.showError(__GadgetMessages.NoFriend):g.showError(c.oauthErrorText):c.text?g.showError(c.text):c.responseText?g.showError(c.responseText):g.showError(__GadgetMessages.General_Error))})},u.prototype.addSkippingResources=function(b){if(b&&this.hostMode==u.Modes.View){var c=b.getResponseHeader("X-LQE-Query-Exec-Invalid-Count"),d=b.getResponseHeader("X-LQE-Query-Exec-Missing-Count"),f=b.getResponseHeader("X-LQE-Query-Exec-Missing-Configurations-Count"),g=b.getResponseHeader("X-LQE-Query-Exec-Skipped-Configurations-Count"),h=b.getResponseHeader("X-LQE-Query-Exec-Missing-Selections-Count"),i=b.getResponseHeader("X-LQE-Query-Exec-Skipped-Selections-Count"),j=b.getResponseHeader("X-LQE-Query-Exec-Skipped-Count"),k=b.getResponseHeader("X-LQE-Query-Exec-Details"),l=b.getResponseHeader("x-lqe-query-indexing-count"),m=b.getResponseHeader("X-LQE-Query-Validation-Count"),n=b.getResponseHeader("X-LQE-Query-Remove-Count"),o=b.getResponseHeader("X-LQE-Result-Modified"),q=b.getResponseHeader("X-LQE-Cache-Hit"),r=b.getResponseHeader("X-RB-Cache-Hit"),s=!1;!this.gadgetSettings.noSettingsAdded&&this.gadgetSettings.islqeQueryTracingEnabled()&&(s=!0);var t;t=q&&"true"==q.trim().toLowerCase()||r&&"true"==r.trim().toLowerCase()?p.Skipping_Resources_Header_cached:p.Skipping_Resources_Header,a("#skipping-resource-alert-header").text(t);var v="<br><span>"+(s?p.Skipping_Resources_Details_1:p.Skipping_Resources_Details_1_1)+"</span><br><style>#skipping-resource-detail .bx--list--unordered > .bx--list__item:before{content: '\\002022';}</style><ul type='disc' class='bx--list--unordered bx--list--nested'>",w=!1;if(j&&j>0&&(w=!0,v=1==j?v+"<li class='bx--list__item'><span><b>"+j+"</b>"+p.Skipping_Resources_Description_Skipped_singular+"</span></li>":v+"<li class='bx--list__item'><span><b>"+j+"</b>"+p.Skipping_Resources_Description_Skipped+"</span></li>"),g&&g>0&&(w=!0,v=1==g?v+"<li class='bx--list__item'><span><b>"+g+"</b>"+p.Skipping_Resources_Description_Skipped_Configurations_singular+"</span></li>":v+"<li class='bx--list__item'><span><b>"+g+"</b>"+p.Skipping_Resources_Description_Skipped_Configurations+"</span></li>"),i&&i>0&&(w=!0,v=1==i?v+"<li class='bx--list__item'><span><b>"+i+"</b>"+p.Skipping_Resources_Description_Skipped_Selections_singular+"</span></li>":v+"<li class='bx--list__item'><span><b>"+i+"</b>"+p.Skipping_Resources_Description_Skipped_Selections+"</span></li>"),d&&d>0&&(w=!0,v=1==d?v+"<li class='bx--list__item'><span><b>"+d+"</b>"+p.Skipping_Resources_Description_Missing_singular+"</span></li>":v+"<li class='bx--list__item'><span><b>"+d+"</b>"+p.Skipping_Resources_Description_Missing+"</span></li>"),f&&f>0&&(w=!0,v=1==f?v+"<li class='bx--list__item'><span><b>"+f+"</b>"+p.Skipping_Resources_Description_Missing_Configurations_singular+"</span></li>":v+"<li class='bx--list__item'><span><b>"+f+"</b>"+p.Skipping_Resources_Description_Missing_Configurations+"</span></li>"),h&&h>0&&(w=!0,v=1==h?v+"<li class='bx--list__item'><span><b>"+h+"</b>"+p.Skipping_Resources_Description_Missing_Selections_singular+"</span></li>":v+"<li class='bx--list__item'><span><b>"+h+"</b>"+p.Skipping_Resources_Description_Missing_Selections+"</span></li>"),c&&c>0&&(w=!0,v=1==c?v+"<li class='bx--list__item'><span><b>"+c+"</b>"+p.Skipping_Resources_Description_Invalid_singular+"</span></li>":v+"<li class='bx--list__item'><span><b>"+c+"</b>"+p.Skipping_Resources_Description_Invalid+"</span></li>"),l&&parseInt(l)>0&&(w=!0,v=1==l?v+"<li class='bx--list__item'><span><b>"+l+"</b>"+p["WebUI_queryStat_LQE-Query-Indexing-Count_singular"]+"</span></li>":v+"<li class='bx--list__item'><span><b>"+l+"</b>"+p["WebUI_queryStat_LQE-Query-Indexing-Count"]+"</span></li>"),m&&parseInt(m)>0&&(w=!0,v=1==m?v+"<li class='bx--list__item'><span><b>"+m+"</b>"+p["WebUI_queryStat_LQE-Query-Validation-Count_singular"]+"</span></li>":v+"<li class='bx--list__item'><span><b>"+m+"</b>"+p["WebUI_queryStat_LQE-Query-Validation-Count"]+"</span></li>"),n&&parseInt(n)>0&&(w=!0,v=1==n?v+"<li class='bx--list__item'><span><b>"+n+"</b>"+p["WebUI_queryStat_LQE-Query-Remove-Count_singular"]+"</span></li>":v+"<li class='bx--list__item'><span><b>"+n+"</b>"+p["WebUI_queryStat_LQE-Query-Remove-Count"]+"</span></li>"),o&&"true"==o.trim().toLowerCase()&&(w=!0,v=v+"<li class='bx--list__item'><span>"+p["WebUI_queryStat_LQE-Result-Modified"]+"</span></li>"),w){var x="<a class='bx--link' href = "+k+" target='_blank'>",y="</a>",z=p.Skipping_Resources_Details_2.replace("{0}",x).replace("{1}",y);v=v+"</ul><span>"+z+"</span>",a("#skipping-resource-detail").html(v),window.parent.document.getElementById("runReportTab")&&a("#viz-select")&&a("#viz-select").find(":selected").val().indexOf("#reportvisualization-table")>-1&&(window.parent.document.getElementById("runReportTab").style.height=window.parent.innerHeight-window.parent.$("#run-report-frame").offset().top+75+"px"),a("#skipping-resource-alert-section").show()}else s&&this.showSuccess(p.Skipping_Resources_NoIssues);var A=a("#Exec-Time");if(0!=A.length){var B=b.getResponseHeader("X-LQE-Query-Running-Count"),C=b.getResponseHeader("X-LQE-Query-Long-Count"),D=b.getResponseHeader("X-LQE-Query-Rogue-Count"),E=b.getResponseHeader("X-LQE-Query-Backup"),F=b.getResponseHeader("X-LQE-Query-Compaction"),G=b.getResponseHeader("X-LQE-Load"),H=!1,I=a("#lqeQueryExecDetailsTemplate"),J=I.find(".lqe-query-stats-content").clone();J.find("span").text(p.WebUI_queryStat_desc);var K,L=J.find(".bx--list--unordered"),M=I.find(".bx--list__item.no-count"),N=I.find(".bx--list__item.with-count");if(B&&parseInt(B)>0&&(H=!0,K=N.clone(),K.find("b").text(B),K.find("span").text(p["WebUI_queryStat_LQE-Query-Running-Count"]),L.append(K)),C&&parseInt(C)>0&&(H=!0,K=N.clone(),K.find("b").text(C),K.find("span").text(p["WebUI_queryStat_LQE-Query-Long-Count"]),L.append(K)),D&&parseInt(D)>0&&(H=!0,K=N.clone(),K.find("b").text(D),K.find("span").text(p["WebUI_queryStat_LQE-Query-Rogue-Count"]),L.append(K)),E&&"true"==E.trim().toLowerCase()&&(H=!0,K=M.clone(),K.find("span").text(p["WebUI_queryStat_LQE-Query-Backup"]),L.append(K)),F&&"true"==F.trim().toLowerCase()&&(H=!0,K=M.clone(),K.find("span").text(p["WebUI_queryStat_LQE-Query-Compaction"]),L.append(K)),G&&"high"==G.trim().toLowerCase()&&(H=!0,K=M.clone(),K.find("span").text(p["WebUI_queryStat_LQE-Load_HIGH"]),L.append(K)),H){var O=a("#lqeQueryExecInfoButtonTemplate").clone();e.appendTooltipToParentWithCustomICON("#Exec-Time","query-stats-icon",J.html(),O.html(),{title:"",html:!0,placement:"left"}),a("#Exec-Time").css({"margin-right":"4px"}).parent().css({zIndex:100})}else a("#query-stats-icon").length>0&&a("#query-stats-icon").remove()}}},u.prototype.createUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)})},u.prototype.runPreview=function(a){this.filters=void 0,this.filterAlert.clear(),this.reportAlert.clear();var b=this.getParameterList();if(b.hasAllRequiredValues()){if(this.notify(u.Events.Previewing),this.prefValues=b.getSelectedValues(),a||(this.previewing=!0),E.filtersToggleTwistie.isClosed()||E.filtersToggleTwistie.trigger("click"),!a){var c=this;this.showLoading(!0),this._doExecute(function(){c.showLoading(!1),c.previewing=!1,setTimeout(function(){c.notify(u.Events.Previewed)},50)},{viz:c._vizMap[c._selectedViz]})}}else this._showMissingRequiredValueMessage()},u.prototype.getFilterString=function(){if(!this.parameterList)return null;var a=null!==this.parameterList.getConfigParameter();return this.hasSavedValues()||this.previewing||a?this.parameterList.getFilterString():""},u.prototype.hasAllRequiredValues=function(){return this.parameterList?this.parameterList.hasAllRequiredValues():!1},u.prototype.onInitialize=function(){},u.prototype.onExecuteTable=function(a,b){throw new Error("abstract method called")},u.prototype._doExecute=function(b,c){function d(){if(g.reportDefinition.isTableVisualization(e)){l.doSpan(a("#_visualization").find("tbody#_resultBody"));var d=a("#_visualization").find(".query-results-table"),f=window.parent.document.location.hash.substring(1);if(1!=f.indexOf("view"))var h=f.substring(f.indexOf("=")+1);if(-1!=f.indexOf("build")){var i=f.substring(f.indexOf("build/")+6),h=i.substring(0,i.indexOf("/"));if("new"===h){var j=g.reportUrl;h=parseInt(j.substring(j.lastIndexOf("/")+1))+1}}if(a(d).attr("id")){var k=a(d).attr("id")+"-"+h;a(d).attr("id",k)}a(d).colResizable({resizeMode:"overflow",useLocalStorage:!0,postbackSafe:!0}),a(d).css("min-width","100%")}b&&b(),setTimeout(function(){g.notify(u.Events.Executed)},50),g.filterAlert.clear(),g.reportAlert.clear(),c.warningMsg&&g.showWarning(c.warningMsg)}var e=c?c.viz:null;e||(e=this.reportDefinition.getDefaultVisualization());var f=this.getParameterList();if(!this.previewing&&(!this.hasSavedValues()&&f.hasRequiredFilters||!this.hasAllRequiredValues())){this._showMissingRequiredValueMessage(),a("#_visualization").addClass("hide"),b&&b(),this.reportDefinition.isChartVisualization(e)&&f.columnFiltersAsGraph(!0);var g=this;return void setTimeout(function(){g.notify(u.Events.Executed)},50)}var h=f.getConfigParameter();if(null!=h&&h.getValues()){var i=h.getValues()?h.getValues()[0]:void 0,j=h.getDisplayValues()?h.getDisplayValues()[0]:void 0;if(j&&"auto"!==i)this.updateSelectedConfigLabel(i,j);else{var g=this;this._getConfigName(i,function(a){g.updateSelectedConfigLabel(i,a)})}}else this.updateSelectedConfigLabel(void 0,void 0);var k=this.filters||this.getFilterString(),m=null;c&&c.ddFilters&&(m=c.ddFilters),this.notify(u.Events.Executing),this._checkExportActionVisibility(k,e);var g=this;w.call(this,f.getSelectedValues()),g.reportDefinition.isChartVisualization(e)?this.onExecuteChart(d,{gadgetSettingsParam:this.gadgetSettings.getGadgetSettingsAsParam(),filter:k,viz:e,ddFilters:m}):g.reportDefinition.isTableVisualization(e)&&this.onExecuteTable(d,{gadgetSettingsParam:this.gadgetSettings.getGadgetSettingsAsParam(),filter:k,viz:e,drilldown:c?c.drilldown:!1,ddFilters:m,warningMsg:c.warningMsg})},u.prototype._showMissingRequiredValueMessage=function(){this._showParameters(!0);var a=this.forcedFilterMessage?this.forcedFilterMessage+" ":"";a+=__GadgetMessages.ProvideRequiredValues,this.showWarning(a)},u.prototype.updateSelectedConfigLabel=function(b,c){b?(a("#text-configlabel").show(),a("#text-configlabel>span>a").text(c?c:b),a("#text-configlabel>span>a").attr("href",b)):(a("#text-configlabel").hide(),a("#text-configlabel>span>a").text(""),a("#text-configlabel>span>a").attr(""))},u.prototype._getConfigName=function(a,c){var d=(this.getReportDefinition().getReportParameters()[0],this.parameterList.getConfigParameter());if(d&&a){if("auto"===a&&(a=D),this.fetchConfigNameRequests){var e=this.fetchConfigNameRequests[a];if(e)return void e.callbacks.push(c)}var f=this.parameterList.getConfigParameter()._rptParam.parameterQuery;f+="/configuration?Config_URL="+a;var g=new b({url:f,contentType:b.ContentType.TEXT,postPaths:["view/partial","numProjects","numComponents"]}),h=this;this.fetchConfigNameRequests||(this.fetchConfigNameRequests={}),this.fetchConfigNameRequests[a]=g,g.callbacks=[],g.callbacks.push(c);var i=function(){var b=g,c=a;return function(a){delete h.fetchConfigNameRequests[c];var d=a.data?a.data.replace(/&amp;/g,"&"):void 0;b.callbacks.forEach(function(a){a(d)})}}();g.send(i)}},u.prototype.resizeContent=function(a){this.hostMode!==u.Modes.OpenSocial&&this.hostMode!==u.Modes.Embedded},u.prototype.start=function(b){if(this._firstLoad=!0,this.notify(u.Events.Initializing),a("#_loading").on("show.bs.modal",function(){setTimeout(function(){a("#_loading").find(".modal-dialog").off("bsTransitionEnd")},350)}),a("#param-modal").on("show.bs.modal",function(){setTimeout(function(){a("#param-modal").find(".modal-dialog").off("bsTransitionEnd"),a("#param-modal").scrollLeft(0)},350)}),a("#abandon-modal").on("show.bs.modal",function(){setTimeout(function(){a("#abandon-modal").find(".modal-dialog").off("bsTransitionEnd")},350)}),this.showLoading(!0),b&&(this.history=b,b.push(this)),this._initRequest(),this._initControls(),this.isOpenSocial()){var c=gadgets.jazz;if(c){var d=this;return c.getContext(function(a){a&&(D=a.globalConfigurationUri?a.globalConfigurationUri:a.localConfigurationUri),d._start()}),void c.addContextChangeCallbackListener(function(){s()})}}this._start()},u.prototype._start=function(){if(this.reportDefinition=new g(__jsonldReportDef),this.reportTitle=this.reportDefinition.getDefinition().title,this.reportDefaults=this.reportDefinition.getReportDefaults(),this.reportDefaults)if(this.isDashboardConfigAware())this.reportDefaults.values["oslc_config.context"]=["auto"];else if(!this.isOpenSocial()){var b=a.cookies.get(B);b&&(this.reportDefaults.values["oslc_config.context"]=[b])}a("body").prepend('<p class="sr-only" tabindex="999">'+__GadgetMessages.WebUI_Gadget_ReportName+" "+this.reportTitle+"</p>"),this.setTitle(d.decodeHtml(this.reportTitle));var c=this.reportDefinition.getReportVisualizations();this._vizMap={};var e=this;a.each(c,function(a,b){e._vizMap[b["@id"]]=b}),this.initVizSelection();var f=this.getReportDefinition().getReportParameters(),h=f.length>0;if(f.length>0){if(this.constantValues&&this.constantValues.length>2){var i=this.constantValues.substring(1,this.constantValues.length-1).split("&");if(i.forEach(function(a){var b=a.indexOf("=");if(b>0){var c=a.substring(0,b),d=null,e=a.substring(b+1);0==e.indexOf("(")&&(e=e.substring(1,e.length-1),d=e.split(" or "));for(var g=0;g<f.length;g++){var h=f[g];if(h.parameterQuerySubjectVariable===c){h.constantValue=d?d:e;break}}}}),h=!1,this.hostMode!=u.Modes.Embedded)for(var j=0;j<f.length;j++){var k=f[j];if(!k.constantValue){h=!0;break}}}this.parameterList.loadParameters(f)}else this.loadFilters();this.parameterList.setConfigContext(D),h&&this.parameterList.hasDynamicFilters?(this.parameterList.loadValues(this.getPrefValues()),a("#show-parameters").removeClass("hide"),E.editButton.prop("disabled",!1),E.saveButton.prop("disabled",!1),a("#show-parameters").click(function(){e._showParameters(!0)})):(a("#show-parameters").addClass("hide"),E.editButton.prop("disabled",!0),E.saveButton.prop("disabled",!0));var l=this.hostMode===u.Modes.View,m={viz:e._vizMap[e._selectedViz]};if(l){a("#_paramsSaveButton").html(__GadgetMessages.WebUI_Run);var o=a.urlhash(parent),p=a.queryToObject(o);m.drilldown=p.dd&&"true"===p.dd[0]?!0:!1;var q=p.viz?p.viz[0]:null;q&&(m.viz=e._vizMap[this.reportUrl+"#"+q]),p.fields&&(m.ddFilters="fields="+encodeURIComponent(p.fields[0]))}this.gadgetSettings=new n({isConfigWare:null!==this.parameterList.getConfigParameter(),uiAppConfigJSON:__uiAppConfigJSON}),this.gadgetSettings.initialize(),this.gadgetSettings.noSettingsAdded?(E.$gadgetSettingsButton.remove(),E.$gadgetSettingsButton=void 0):(E.$gadgetSettingsButton.reclick(function(a){E.$gadgetSettingsContent.is(":visible")?E.$gadgetSettingsContent.hide():(E.filtersToggleTwistie.isClosed()&&E.filtersToggle.click(),E.$gadgetSettingsContent.show())}),E.$gadgetSettingsContent.find("button.close").click(function(a){E.$gadgetSettingsContent.hide()}),this.gadgetSettings.data=this.getPrefGadgetSettings()),this._doExecute(function(){e.showSection("#_main"),e.showLoading(!1)},m),this.renderHistory()},u.prototype.renderHistory=function(){
var b=this.hostMode===u.Modes.View;this.history.count()>1?a("#_banner").show():a("#_banner").hide(),this.history&&this.history.render(b)},u.prototype.doDrilldown=function(a,b){this._showParameters(!1)},u.prototype.setTitle=function(a){this.hostMode===u.Modes.OpenSocial&&gadgets.window.setTitle(a)},u.prototype.getTitle=function(){return this.reportTitle},u.prototype.hasParameters=function(){return this.getReportDefinition().getReportParameters().length>0},u.prototype.setMode=function(a){this.hostMode=a},u.prototype.isOpenSocial=function(){return this.hostMode===u.Modes.OpenSocial},u.prototype.initVizSelection=function(){var b=this,c=a("#viz-select");c.html("");var d=0,e=0;for(var f in b._vizMap){var g=b._vizMap[f];$option=a("<option></option>"),c.append($option);var h="";b.reportDefinition.isChartVisualization(g)?(h=__GadgetMessages.WebUI_Gadget_GraphView+(e>0?" "+e:""),e++):b.reportDefinition.isTableVisualization(g)&&(h=__GadgetMessages.WebUI_Gadget_TableView+(d>0?" "+d:""),d++),$option.attr("value",g["@id"]).text(h)}var i=this.reportDefinition.getDefaultVisualization();this._selectedViz=i["@id"];var j=this.getUserPref(A);j&&""!==j&&(this._selectedViz=j),0==d||0==e?this.displayVizDropdown(!1):(a("#viz-select").val(this._selectedViz).trigger("change"),this.displayVizDropdown(!0)),c.change(function(){b._selectedViz=a(this).find("option:selected").val(),b.setUserPref(A,b._selectedViz),b._doExecute(null,{viz:b._vizMap[b._selectedViz]})})},u.prototype._checkExportActionVisibility=function(b,c){$exportChartOnly=a(".export-chart-only").find("a"),this.reportDefinition.isChartVisualization(c)?$exportChartOnly.show():$exportChartOnly.hide();var d=this.reportDefinition.getDefinition().identifier;$exportChartOnly.each(function(){var e=a(this);e.data("origHRef")||e.data("origHRef",e.attr("href"));var f=e.data("origHRef"),g=c["@id"],h=g.substring(__reportDefinitionUrl.length+1,g.length);f+="?viz="+h+"&report="+d,b&&""!=b&&(f+="&"+b),e.attr("href",f)})},u.prototype.displayVizDropdown=function(b){b?(a("#viz-select").show(),a("#viz-select-title").show(),a("#nav-contents").addClass("tab-content")):(a("#viz-select").hide(),a("#viz-select-title").hide(),a("#nav-contents").removeClass("tab-content"))},u.prototype.isDashboardConfigAware=function(a){return"unset"!==D},u.Modes={OpenSocial:"opensocial",View:"view",Embedded:"embedded"},u.Events={Initializing:"gadget-do-initialize",Initialized:"gadget-post-initialize",TablePageMoved:"gadget-post-table-PageMoved",LoadingParameters:"gadget-loading-params",LoadedParameters:"gadget-loaded-params",Previewing:"gadget-do-preview",Previewed:"gadget-post-preview",Executing:"gadget-do-execute",Executed:"gadget-post-execute"},u.Exports={ParameterList:k,BidiUtils:c,HtmlUtils:d},u});