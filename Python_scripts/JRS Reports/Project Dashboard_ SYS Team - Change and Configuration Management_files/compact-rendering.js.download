/*******************************************************************************
 * Licensed Materials - Property of IBM
 * Â© Copyright IBM Corporation 2014, 2024. All Rights Reserved.
 * 
 * Note to U.S. Government Users Restricted Rights:
 * Use, duplication or disclosure restricted by GSA ADP Schedule
 * Contract with IBM Corp.
 *******************************************************************************/
require(["common/jquery-ext","common/htmlUtils","common/tooltipUtils","i18n!nls/messages","common/request"],function(a,b,c,d,e){function f(b){var c=a(b),e="",f=!1,m="";e='<div class="popover jrs-compact-render" style="display: block; z-index: 1030; background-color: #FFFFFF; max-width: 900px; position: absolute; background-clip: padding-box; border-style: solid; border-width: 1px; border-color: rgba(0, 0, 0, 0.2); border-radius: 6px; box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2)"><div class="arrow1"></div><div class="arrow2"></div><div style="background-color:#F7F7F7; border-bottom:1px solid #EBEBEB; border-radius: 5px 5px 0 0; font-size: 14px; font-weight:normal; margin:0; display:flex; justify-content:space-between;"><div style="display:inline-flex;float:left"><h3 class="popover-title" style="font-size: 14px; font-weight: normal;line-height: 18px; margin: 0; padding: 8px 14px;"></h3></div><button id="closeHoverDialog" type="button" style="align-self:start; display:inline-flex; float:right; background:none; outline:none; border:none;padding:10px;"><img id="closeHoverIcon" class="close-hover-icon" src="/rs/graphics/close-hov.gif" style="height:100%; width:100%;"></button></div><div class="popover-content" style="padding: 9px;border-bottom:1px solid #ebebeb"></div><div style="padding:5px;"><a href="javascript:void(0)" class="bx--link show-large-preview" style="padding:10px;font-size:12px;"><span style="margin-left:10px;">'+d.showMore+'</span></a><a href="javascript:void(0)" class="bx--link show-small-preview" style="padding:10px;font-size:12px;display:none"><span style="margin-left:7px;">'+d.showLess+"</span></a></div></div>",c.popover({trigger:"manual",placement:function(b,d){var e=a(d).position(),i=e.left,j=e.top,n=window.frameElement;if(n)do i+=n.offsetLeft,j+=n.offsetTop,n=n.offsetParent;while(n);var p=window.document.body,q=window.document.documentElement,r=window.pageYOffset||q.scrollTop||p.scrollTop,s=window.pageXOffset||q.scrollLeft||p.scrollLeft;i-=s,j-=r,p=window.parent.document.body,q=window.parent.document.documentElement;var t=window.parent.pageYOffset||q.scrollTop||p.scrollTop,u=window.parent.pageXOffset||q.scrollLeft||p.scrollLeft;i-=u,j-=t;var v=null;m=c.attr("href");var w=g(__reportDefinitionUrl.slice(0,__reportDefinitionUrl.indexOf("reportdefinition"))+"compacturl?url="+m);if(null==w){var x=h(c.attr("data-compact"),m);w=o[x],"qm"==x&&(f=!0,l=null)}else k=w;var y=36,z=9;z+=6;var A,B=12,C=18,D=10;A=w.hintHeight.endsWith("em")?parseInt(16*w.hintHeight.substring(0,w.hintHeight.length-2),10)/2:parseInt(w.hintHeight.substring(0,w.hintHeight.length-2),10)/2;var E,F=A+B+y,G=A+C;E=w.hintWidth.endsWith("em")?parseInt(16*w.hintWidth.substring(0,w.hintWidth.length-2),10)+2*z:parseInt(w.hintWidth.substring(0,w.hintWidth.length-2),10)+2*z;var H=i+d.offsetWidth/2,I=j+d.offsetHeight/2,J=i+d.offsetWidth,K=j+d.offsetHeight,L=window.parent.innerHeight-(K+F+G+D),M=j-F-G-D+10,N=window.parent.innerWidth-(J+E+D)-10,O=i-E-D+6;if(N>=0?v="right":O>=0?v="left":L>=0?v="bottom":M>=0&&(v="top"),!v){var P;L>M?(P=L,v="bottom"):(P=M,v="top"),O>P&&(P=O,v="left"),N>P&&(v="right")}var Q=0,R=0,S=50,T=0,U=0;if("left"===v||"right"===v){Q="left"===v?O+u:J+D+2+u,R=I-F+t;var V=window.parent.innerHeight-(I+G),W=R-t,X=0;if(0>W&&V>0?(X=W+V>=0?-W:V,X>0&&(R+=X)):0>V&&W>0&&(X=W+V>=0?-V:W,X>0&&(R-=X)),0>R-t&&(U=2*A+R-t,R=t),R-t+F+G>window.parent.innerHeight&&(U=window.parent.innerHeight-B-C-y-(R-t)),"left"===v?0>Q-u&&(T=E+Q-u-2*z,Q=u):Q-u+E>window.parent.innerWidth&&(T=window.parent.innerWidth-Q+u-2*z-D-5),X>0||U){var Y=U>0?U+B+C+y:G+F;S=Math.round(Math.abs(100*(I-R+t)/Y))}}if("top"===v||"bottom"===v){R="top"===v?M+t:K+D+2+t,Q=H-E/2+u;var Z=window.parent.innerWidth-(H+E/2),$=Q-u,X=0;if(0>$&&Z>0?(X=$+Z>=0?-$:Z,X>0&&(Q+=X)):0>Z&&$>0&&(X=$+Z>=0?-Z:$,X>0&&(Q-=X)),0>Q-u&&(T=E+Q-2*z,Q=u),Q-u+E>window.parent.innerWidth&&(T=window.parent.innerWidth-Q+u-2*z-5),"top"===v?0>R-t&&(U=2*A+R-t,R=t):R-t+F+G+D>window.parent.innerHeight&&(U=window.parent.innerHeight-B-C-y-(R-t)-D),X>0||T){var _=T>0?T+2*z:E;S=Math.round(Math.abs(100*(H-Q+u)/_))}}a(d).data("popoverY",R),a(d).data("popoverX",Q),a(d).data("arrow",S);var aa=a(b).find(".arrow1");aa&&aa.attr("style","");var ba=a(b).find(".arrow2");return ba&&ba.attr("style",""),a(b).css("visibility","hidden"),v},title:"Loading...",html:!0,template:e,container:this.parent.document.body});var s=a(this.parent.document.body);c.on("shown.bs.popover",function(){var b,d,e=s.find(".show-large-preview"),g=s.find(".show-small-preview"),h=s.find("#closeHoverDialog"),i=s.find("#closeHoverIcon");r||(b=a(a(window.parent.document).find(".popover")).find(".compactRenderFrame").height(),d=a(a(window.parent.document).find(".popover")).find(".compactRenderFrame").width(),a(a(window.parent.document).find(".popover-title")).css("max-width",d+"px")),l||!m.includes("scm/versionable")&&!m.includes("scm.ChangeSet")||a(e).css("display","none"),a(e).on("click",function(){r=!1,k=l,k.smallPreviewInitialHeight=b,k.smallPreviewInitialWidth=d,a(a(window.parent.document).find(".popover")).find(".compactRenderFrame").attr("src",k.compacturllarge),a(this).css("display","none"),a(g).css("display","inline")}),a(g).on("click",function(){k=l,a(a(window.parent.document).find(".popover")).find(".compactRenderFrame").attr("src",k.compacturl),a(this).css("display","none"),a(e).css("display","inline")}),a(h).on("click",function(){var b=a(window.parent.document.body).find(".popover");b.length&&(n=10,r=!1,j(b,!0))}),a(h).on("mouseenter",function(){a(i).attr("src","/rs/graphics/close-hov-red.gif")}),a(h).on("mouseleave",function(){a(i).attr("src","/rs/graphics/close-hov.gif")});var o=s.find(".popover"),p=o.find(".arrow1"),q=o.find(".arrow2"),t=c.data("arrow");o.css({top:c.data("popoverY")+"px",left:c.data("popoverX")+"px"}),o.css("visibility","visible");var u={"border-style":"solid","border-width":"10px",height:"0",width:"0",position:"absolute",display:"none"},v={"border-style":"solid","border-width":"10px",height:"0",width:"0",position:"absolute",display:"none"},w=o.attr("class").split(/\s+/);if(a.each(w,function(a,b){var c=!0;"top"===b?(u["border-color"]="#CCCCCC transparent transparent transparent",u.bottom="-21px",u.left=t+"%",v["border-color"]="#FFFFFF transparent transparent transparent",v.bottom="-19px",v.left=t+"%"):"bottom"===b?(u["border-color"]="transparent transparent #CCCCCC transparent",u.top="-21px",u.left=t+"%",v["border-color"]="transparent transparent #FFFFFF transparent",v.top="-19px",v.left=t+"%"):"right"===b?(u["border-color"]="transparent #CCCCCC transparent transparent",u.left="-21px",u.top=t+"%",v["border-color"]="transparent #FFFFFF transparent transparent",v.left="-19px",v.top=t+"%"):"left"===b?(u["border-color"]="transparent transparent transparent #CCCCCC",u.right="-21px",u.top=t+"%",v["border-color"]="transparent transparent transparent #FFFFFF",v.right="-19px",v.top=t+"%"):c=!1,c&&(p.css(u),q.css(v))}),f){var x='<div style="margin: 0; padding: 8px 14px;"><h2 style="font-size: 16px; font-weight: normal;">No Preview Available</h2><a href="'+m+'">'+m+"</a></div>";s.find("#myFrame").attr("src",""),s.find("#myFrame").height("300px"),s.find(".popover-content").prepend(x)}}),c.is(":hover")&&i(c),c.on("mouseleave",function(){r||j(c)}),p&&!q&&(a(this.parent.document).on("mouseenter",".popover",function(){a(this).addClass("hover")}),a(this.parent.document).on("mouseenter",".popover iFrame",function(){a(this).parents(".popover").addClass("hover")}),a(this.parent.document).on("mouseleave",".popover",function(b){var c=b.clientX,d=b.clientY,e=this.getBoundingClientRect(),f=e.left<=c&&c<=e.right&&e.top<=d&&d<=e.bottom;f||a(this).removeClass("hover")}),q=!0)}function g(b,c){var d=null,f=b,g=new e({url:f,contentType:e.ContentType.JSON});return g.setUrl(f),g.send(function(b){try{a.isOpenSocial()&&b.text?(d=JSON.parse(b.text),l=JSON.parse(b.text)):b.data?(d=b.data,l=b.data):_errMsg="Unable to get the compactURL details"}catch(c){console.log(c)}},!0),d}function h(a,b){return"rm"==a&&b.indexOf("/dwa/rm")>0&&(a="dwa"),"cm"==a&&b.indexOf("team.scm.ChangeSet/")>0&&(a="scm"),a}function i(c){var d=a(c),e=d.data("hoverState");if(e){clearTimeout(d.data("timeout")),d.data("hoverState","in");var i=setTimeout(function(){var b=function(){var c=a(this.parent.document.body).find(".popover");c.length?setTimeout(function(){b()},200):"in"==d.data("hoverState")&&d.popover("show")};b()},m);d.data("timeout",i)}else{var j=d.attr("href"),k=g(__reportDefinitionUrl.slice(0,__reportDefinitionUrl.indexOf("reportdefinition"))+"compacturl?url="+j);if(null==k){var l=h(d.attr("data-compact"),j);if(k=o[l],"dwa"===l){var n=j.indexOf("/dwa/rm/");-1!=n&&(j=j.substring(0,n)+"/dwa/rm/calm/linkrenderingcontent?urn="+j.substring(n+8,j.length).replace("/view:","&view="))}var p=k.params,q=k.urlAppend,r=j.indexOf("?");r>=0&&(0==p.indexOf("?")&&(p=p.replace("?","&")),p=j.substring(r)+p,j=j.substring(0,r));var s=j+q+p;n=j.indexOf("/resource-rmm"),-1!=n&&"cm"==l&&(k.hintHeight="150px",s=j.substring(0,n)+"/_ajax-modules/com.ibm.team.rmm.ResourceLinkViewer?resourceUri="+j+"&isExpanded=false")}else s=k.compacturl;d.attr("data-content","<iframe id='myFrame' class='rich-hover compactRenderFrame' src=\""+s+'" style="height: 480px; width: 620px;"></iframe>');var t=b.encodeHtml(d.text()),u=d.attr("this-varname"),v="",w=u+"_title";if(v=b.encodeHtml(d.parent().parent().data().values[w]),t===v){var x="";if(x=u.toLowerCase().startsWith("oslc_rm_requirement")||u.toLowerCase().startsWith("am_merged_architecture")?u+"_identifier":u+"_shortId",void 0==d.parent().parent().data().values[x]){var y=u.substr(3,u.length);x="1"===y?"REFERENCE_ID":"REFERENCE_ID"+(y-1)}t=b.encodeHtml(d.parent().parent().data().values[x])}!v&&w.endsWith("_title_title")&&(w=w.substr(0,w.length-6),v=b.encodeHtml(d.parent().parent().data().values[w])),v?t?d.attr("data-original-title",t+": "+v):d.attr("data-original-title","?: "+v):t?d.attr("data-original-title",t+": "):d.attr("data-original-title","?: ");var i=setTimeout(function(){var b=function(){var e=a(this.parent.document.body).find(".popover");e.length?setTimeout(function(){b()},50):(f(c),d.data("hoverState","in"))};b()},m);d.data("timeout",i)}}function j(b,c){clearTimeout(b.data("timeout"));var d=setTimeout(function(){var d=function(){var e=p?".popover.hover":".popover:hover",f=a(this.parent.document.body).find(e).length;if(!f||c){if(!a(".popover:hover").length&&!r){clearTimeout(b.data("timeout")),n=800,r=!1;var g=a(this.parent.document.body);g.find(".show-small-preview").css("display","none"),g.find(".show-large-preview").css("display","inline"),g.find("#closeHoverIcon").attr("src","/rs/graphics/close-hov.gif"),b.data("hoverState","out"),b.popover("hide")}}else setTimeout(function(){d()},n)};d()},n);b.data("timeout",d)}var k,l,m=600,n=800,o={cm:{hintHeight:"480px",hintWidth:"620px",urlAppend:"",params:"?_mediaType=text%2Fhtml&_selector=smallHover&_context=web"},scm:{hintHeight:"480px",hintWidth:"620px",urlAppend:"",params:"?preview=small"},rm:{hintHeight:"480px",hintWidth:"620px",urlAppend:"/compact/html",params:"?hover=small"},qm:{hintHeight:"480px",hintWidth:"620px",urlAppend:"",params:"?_selector=abbrevDocument&_mediaType=text%2Fhtml"},dwa:{hintHeight:"480px",hintWidth:"620px",urlAppend:"",params:"?hover=small&version=1.0"},project:{hintHeight:"480px",hintWidth:"620px",urlAppend:"/smallPreview",params:""}},p=c.isBrowserIE(),q=!1,r=!1;a(document).on("mouseenter","[data-compact]",function(){r||i(this)}),a(this.parent.document).find(".popover.jrs-compact-render").remove(),a(document).on("click",function(){var b=a(window.parent.document.body).find(".popover");b.length&&(n=10,r=!1,j(b))})});